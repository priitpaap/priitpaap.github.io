{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Tere tulemast!","text":"<p>Tegemist on \u00f5ppematerjalide lehega kust v\u00f5ib m\u00f5ned juhendid ja materjalid juba leida.</p> <p>Tasapisi t\u00e4ieneb.</p>"},{"location":"leht1/","title":"Teema 1","text":"<p>Oi oi, Tere tulemast minu lehele lugema seda toredat teksti!</p>"},{"location":"leht1/#alamteema","title":"Alamteema","text":"<p>Warning</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <p>Siin on <code>/var/lob/somefolder</code> kood</p> <p>N\u00fc\u00fcd tuleb pikem koodirida:</p> <pre><code>sudo -i\napt update\n// See on kommentaar\n# some other comment\n</code></pre> <p>Code for specific language:</p> <pre><code>Get-Childitem\necho kala\n</code></pre>"},{"location":"leht1/#kolmanda-taseme-teema","title":"Kolmanda taseme teema","text":"<p>kjlklkjl</p> Note <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p> <p>Phasellus posuere in sem ut cursus</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod nulla. Curabitur feugiat, tortor non consequat finibus, justo purus auctor massa, nec semper lorem quam in massa.</p>"},{"location":"leht2/","title":"Leht2","text":"CC++ <pre><code>#include &lt;stdio.h&gt;\n\nint main(void) {\n  printf(\"Hello world!\\n\");\n  return 0;\n}\n</code></pre> <pre><code>#include &lt;iostream&gt;\n\nint main(void) {\n  std::cout &lt;&lt; \"Hello world!\" &lt;&lt; std::endl;\n  return 0;\n}\n</code></pre>"},{"location":"ansible/ansiblebestpractises/","title":"Ansible parimad praktikad","text":""},{"location":"ansible/ansiblebestpractises/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid tundma Ansible projektide parimaid tavasid, mis aitavad muuta sinu automatiseerimise t\u00f6\u00f6kindlamaks, korduvkasutatavamaks ja paremini hallatavaks.</p>"},{"location":"ansible/ansiblebestpractises/#rollide-kasutamine-modulariseerimine","title":"Rollide kasutamine (modulariseerimine)","text":"<p>Kasuta rolle, et jagada playbookid v\u00e4iksemateks ja taaskasutatavateks komponentideks. See teeb projektid loogilisemaks ja lihtsustab koost\u00f6\u00f6d tiimides.</p> <p>N\u00e4iteks:</p> <pre><code>roles:\n  - common\n  - nginx\n  - mysql\n</code></pre>"},{"location":"ansible/ansiblebestpractises/#hoia-playbookid-lihtsad-ja-loetavad","title":"Hoia playbookid lihtsad ja loetavad","text":"<ul> <li>Kasuta selgeid, kirjeldavaid nimesid (n\u00e4iteks <code>Paigalda Nginx</code>, mitte lihtsalt <code>Install</code>).  </li> <li>Lisa kommentaare, kui tegevus pole iseenesestm\u00f5istetav.  </li> <li>V\u00e4ldi liigseid tingimusi ja pikki shell-k\u00e4ske \u2014 kasuta mooduleid.</li> </ul> <p>Hea n\u00e4ide:</p> <pre><code>- name: Paigalda nginx veebiserver\n  apt:\n    name: nginx\n    state: present\n</code></pre>"},{"location":"ansible/ansiblebestpractises/#kasuta-versioonihaldust-git","title":"Kasuta versioonihaldust (Git)","text":"<p>Hoia oma playbooke, rolle ja inventare versioonihalduses (nt GitHub, GitLab, Bitbucket).</p> <p>Eelised:</p> <ul> <li>muudatuste ajalugu ja taastev\u00f5imalus</li> <li>koost\u00f6\u00f6 tiimiliikmete vahel</li> <li>CI/CD integreerimine</li> </ul> <p>Struktuuriversioonid v\u00f5ivad v\u00e4lja n\u00e4ha nii:</p> <pre><code>ansible-project/\n\u251c\u2500\u2500 playbooks/\n\u251c\u2500\u2500 roles/\n\u251c\u2500\u2500 group_vars/\n\u2514\u2500\u2500 inventory/\n</code></pre>"},{"location":"ansible/ansiblebestpractises/#parameetriseeri-koik","title":"Parameetriseeri k\u00f5ik","text":"<p>V\u00e4ldi k\u00f5vakoodeeritud v\u00e4\u00e4rtusi. Kasuta muutujaid ja mal\u00adle (<code>templates/</code>), et muuta playbookid paindlikuks.</p> <p>N\u00e4ide:</p> <pre><code>- name: Loo Nginx konfiguratsioonimall\n  template:\n    src: nginx.conf.j2\n    dest: /etc/nginx/nginx.conf\n</code></pre> <p>Ja mallis (<code>nginx.conf.j2</code>):</p> <pre><code>server {\n    listen {{ nginx_port }};\n}\n</code></pre>"},{"location":"ansible/ansiblebestpractises/#inventari-haldus","title":"Inventari haldus","text":"<p>Jaga hostid ja grupid loogiliselt (nt <code>dev</code>, <code>test</code>, <code>prod</code>). Kasuta grupimuutujaid (<code>group_vars</code>) ja hostimuutujaid (<code>host_vars</code>), et v\u00e4ltida dubleerimist.</p> <p>N\u00e4ide:</p> <pre><code>inventory/\n\u251c\u2500\u2500 hosts\n\u251c\u2500\u2500 group_vars/\n\u2502   \u251c\u2500\u2500 web.yml\n\u2502   \u2514\u2500\u2500 db.yml\n\u2514\u2500\u2500 host_vars/\n    \u2514\u2500\u2500 server1.yml\n</code></pre>"},{"location":"ansible/ansiblebestpractises/#idempotentsus","title":"Idempotentsus","text":"<p>Idempotentsus t\u00e4hendab, et sama playbooki v\u00f5ib k\u00e4ivitada mitu korda ja tulemus j\u00e4\u00e4b samaks. N\u00e4iteks kui teenus on juba installitud, ei tee Ansible seda uuesti.</p> <p>Hea tava: kasuta mooduleid nagu <code>apt</code>, <code>service</code>, <code>file</code> ja <code>user</code>, mitte toorest <code>command</code> v\u00f5i <code>shell</code>, kui v\u00f5imalik.</p>"},{"location":"ansible/ansiblebestpractises/#testimine-ja-valideerimine","title":"Testimine ja valideerimine","text":"<p>Enne tootmiskeskkonda saatmist:</p> <ol> <li>Testi playbooke virtuaalmasinas v\u00f5i konteineris (nt Vagrant, Docker, Molecule).  </li> <li>Kontrolli s\u00fcntaksit: <pre><code>ansible-playbook playbook.yml --syntax-check\n</code></pre></li> <li>Kasuta dry run re\u017eiimi: <pre><code>ansible-playbook playbook.yml --check\n</code></pre></li> </ol>"},{"location":"ansible/ansiblebestpractises/#turvalisus-ja-konfidentsiaalsus","title":"Turvalisus ja konfidentsiaalsus","text":"<ul> <li>Kasuta Ansible Vault\u2019i tundlike andmete (paroolid, API v\u00f5tmed) kr\u00fcpteerimiseks:   <pre><code>ansible-vault encrypt vars/secrets.yml\n</code></pre></li> <li>Hoia v\u00f5tmiseid (SSH, Vault paroolid) v\u00e4ljaspool jagatud repo\u2019sid.</li> <li>Piira \u00f5igusi juhts\u00f5lmel (control node).</li> <li>Kasuta v\u00e4ikseima privileegi printsiipi (least privilege).</li> </ul>"},{"location":"ansible/ansiblebestpractises/#teised-head-tavad","title":"Teised head tavad","text":"<ul> <li>Defineeri standardsed failistruktuurid (nt k\u00f5ik projektid n\u00e4evad v\u00e4lja sarnaselt).  </li> <li>Kasuta tag\u2019e (nt <code>--tags \"install\"</code>) kindlate tegevuste sihtimiseks.  </li> <li>Logi tulemusi ja kasuta <code>ansible.cfg</code> failis sobivaid logis\u00e4tteid.  </li> <li>Dokumenteeri muutujad ja rollide eesm\u00e4rgid <code>README.md</code> failides.</li> </ul>"},{"location":"ansible/ansiblebestpractises/#rohkem-infot","title":"Rohkem infot","text":"<ul> <li>Ansible Best Practices (Official Docs)</li> <li>Ansible Lint</li> </ul>"},{"location":"ansible/ansibleconditionals/","title":"Tingimuslikkus","text":""},{"location":"ansible/ansibleconditionals/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Kuidas kasutada tingimuslikke k\u00e4ske (when) Ansible\u2019is  </li> <li>Kuidas teha tegevusi ainult siis, kui teatud tingimus on t\u00e4idetud  </li> <li>Kuidas kasutada loogikaoperaatoreid ja muutujate kontrolli </li> <li>Kuidas kombineerida tingimusi Jinja2 s\u00fcntaksiga  </li> <li>Kuidas testida ja siluda tingimuslikke \u00fclesandeid</li> </ul>"},{"location":"ansible/ansibleconditionals/#mis-on-tingimuslikkus","title":"Mis on tingimuslikkus?","text":"<p>Tingimuslikkus (<code>when:</code>) v\u00f5imaldab Ansible\u2019il teha otsuseid jooksvalt, olenevalt masinate seisundist v\u00f5i muutujate v\u00e4\u00e4rtustest.</p> <p>N\u00e4iteks:</p> <ul> <li>k\u00e4ivita teenus ainult siis, kui see on paigaldatud;  </li> <li>paigalda pakett ainult Debianil;  </li> <li>k\u00e4ivita teatud task ainult siis, kui eelmine \u00f5nnestus v\u00f5i muutuja on m\u00e4\u00e4ratud.</li> </ul> <p>Lihtne n\u00e4ide:</p> <pre><code>---\n- name: Tingimuslikkuse n\u00e4ide\n  hosts: all\n  become: yes\n  tasks:\n    - name: Paigalda Apache ainult Debiani s\u00fcsteemides\n      apt:\n        name: apache2\n        state: present\n      when: ansible_facts['os_family'] == \"Debian\"\n</code></pre> <p>Selgitus:</p> <ul> <li><code>when:</code> m\u00e4\u00e4rab, et see task t\u00e4idetakse ainult siis, kui sihtmasina <code>os_family</code> on Debian (meeldetuletuseks: Ansible kogub gather_fact parameetreid hostide kohta).</li> <li>Kui host on nt CentOS (RedHat), siis see task j\u00e4etakse vahele (<code>skipped</code>).</li> </ul>"},{"location":"ansible/ansibleconditionals/#loogikaoperaatorid","title":"Loogikaoperaatorid","text":"<p>Tingimustes saab kasutada Jinja2 loogikaoperaatoreid:</p> Operaator N\u00e4ide Selgitus <code>==</code> <code>when: ansible_facts['distribution'] == 'Ubuntu'</code> v\u00f5rdsus <code>!=</code> <code>when: package_name != 'nginx'</code> mitte v\u00f5rdsus <code>and</code> <code>when: ansible_facts['os_family'] == 'Debian' and ansible_facts['pkg_mgr'] == 'apt'</code> m\u00f5lemad tingimused peavad kehtima <code>or</code> <code>when: use_ssl or enable_https</code> v\u00e4hemalt \u00fcks peab kehtima <code>not</code> <code>when: not debug_mode</code> eitab tingimust <code>in</code> <code>when: ansible_facts['distribution'] in ['Ubuntu', 'Debian']</code> v\u00e4\u00e4rtus kuulub loendisse"},{"location":"ansible/ansibleconditionals/#mitu-tingimust-korraga","title":"Mitu tingimust korraga","text":"<p>Tingimusi saab m\u00e4\u00e4rata ka nimekirjana. K\u00f5ik tingimused peavad siis olema t\u00f5esed (AND):</p> <pre><code>- name: Paigalda nginx ainult Debian 13 serveritesse\n  apt:\n    name: nginx\n    state: present\n  when:\n    - ansible_facts['os_family'] == \"Debian\"\n    - ansible_facts['distribution_major_version'] == \"13\"\n</code></pre>"},{"location":"ansible/ansibleconditionals/#tingimused-muutujate-pohjal","title":"Tingimused muutujate p\u00f5hjal","text":"<p>Sageli kontrollitakse, kas muutuja on olemas v\u00f5i omab kindlat v\u00e4\u00e4rtust.</p> <p>Muutuja olemasolu kontroll (<code>is defined</code>):</p> <pre><code>- name: Loo kataloog ainult siis, kui muutuja on m\u00e4\u00e4ratud\n  file:\n    path: \"{{ custom_dir }}\"\n    state: directory\n  when: custom_dir is defined\n</code></pre> <p>Muutuja v\u00e4\u00e4rtuse kontroll (<code>is not defined</code>, <code>is truthy</code>, <code>is falsy</code>):</p> <pre><code>- name: Tee midagi ainult siis, kui lipp on t\u00f5ene\n  debug:\n    msg: \"Lipp on aktiivne\"\n  when: my_flag | default(false)\n</code></pre>"},{"location":"ansible/ansibleconditionals/#kombineerimine-jinja2-suntaksiga","title":"Kombineerimine Jinja2 s\u00fcntaksiga","text":"<p>Tingimused kasutavad sama Jinja2 s\u00fcntaksit, mida kasutatakse mallides.</p> <p>N\u00e4ide, kus kontrollitakse loendi pikkust ja v\u00e4\u00e4rtust:</p> <pre><code>- name: N\u00e4ita s\u00f5numit kui serverite arv on \u00fcle 3\n  debug:\n    msg: \"S\u00fcsteemis on palju servereid!\"\n  when: servers | length &gt; 3\n</code></pre> <p>N\u00e4ide kombineeritud tingimustest:</p> <pre><code>- name: Paigalda MariaDB, kui OS on Debian ja muutuja db_enabled on true\n  apt:\n    name: mariadb-server\n    state: present\n  when:\n    - ansible_facts['os_family'] == \"Debian\"\n    - db_enabled | default(false)\n</code></pre>"},{"location":"ansible/ansibleconditionals/#tingimused-mooduli-tulemuse-pohjal","title":"Tingimused mooduli tulemuse p\u00f5hjal","text":"<p>Paljud moodulid salvestavad oma tulemuse muutujasse (<code>register:</code>). Seda saab kasutada j\u00e4rgnevates tingimustes.</p> <pre><code>---\n- name: Kontrolli teenuse olekut ja taask\u00e4ivita vajadusel\n  hosts: webservers\n  become: yes\n  tasks:\n    - name: Kontrolli, kas nginx t\u00f6\u00f6tab\n      shell: systemctl is-active nginx\n      register: nginx_status\n      ignore_errors: yes\n\n    - name: K\u00e4ivita nginx, kui see ei t\u00f6\u00f6ta\n      service:\n        name: nginx\n        state: started\n      when: nginx_status.rc != 0\n</code></pre> <p>Selgitus:</p> <ul> <li><code>register:</code> salvestab mooduli v\u00e4ljundi muutujasse <code>nginx_status</code>.</li> <li><code>rc</code> (return code) v\u00e4\u00e4rtus <code>0</code> t\u00e4hendab, et k\u00e4sk \u00f5nnestus.</li> <li>Kui see ei olnud 0, k\u00e4ivitatakse teenus uuesti.</li> </ul>"},{"location":"ansible/ansibleconditionals/#testimine-ja-veaotsing","title":"Testimine ja veaotsing","text":"<p>Tingimuslike taskide kontrollimiseks on kasulik kasutada:</p> <ul> <li><code>--check</code> \u2013 n\u00e4itab, mis toimuks, ilma et tegelikult muudaks;</li> <li><code>-v</code> v\u00f5i <code>-vvv</code> \u2013 kuvab t\u00e4pse p\u00f5hjuse, miks m\u00f5ni task j\u00e4i \u201eskipped\u201c;</li> <li><code>debug:</code> \u2013 v\u00e4ljastab muutujate v\u00e4\u00e4rtusi.</li> </ul> <p>N\u00e4ide:</p> <pre><code>- name: Kontrolli muutuja v\u00e4\u00e4rtust\n  debug:\n    var: db_enabled\n</code></pre>"},{"location":"ansible/ansibleconditionals/#head-tavad-tingimuslikkuse-kasutamisel","title":"Head tavad tingimuslikkuse kasutamisel","text":"<ul> <li>V\u00e4ldi liiga keerukaid tingimusi \u2013 parem on jagada loogika mitmeks lihtsaks taskiks.  </li> <li>Kasuta <code>| default()</code> filtrit, et v\u00e4ltida \u201eundefined\u201c vigu.  </li> <li>Kontrolli OS-i t\u00fc\u00fcpi alati <code>ansible_facts</code> kaudu (nt <code>ansible_facts['os_family']</code>), mitte k\u00e4sitsi m\u00e4\u00e4ratud muutujate p\u00f5hjal.  </li> <li>Testi <code>--check</code> ja <code>-vvv</code> abil, et m\u00f5ista, miks m\u00f5ni task j\u00e4eti vahele.  </li> <li>V\u00e4ldi shelli k\u00e4ske, kui moodul juba toetab tingimusi v\u00f5i idempotentsust.</li> </ul>"},{"location":"ansible/ansibleconditionals/#rohkem-infot","title":"Rohkem infot","text":"<ul> <li>Ansible Conditionals </li> <li>Jinja2 Tests and Operators </li> </ul>"},{"location":"ansible/ansibleconf/","title":"Ansible levinumad seadistused","text":""},{"location":"ansible/ansibleconf/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Mis on <code>ansible.cfg</code></li> <li>Millises j\u00e4rjekorras Ansible seadistusfaili otsib</li> <li>Millised levinumad prameetrid, mida seadistusfaili lisada projekti tasemel</li> </ul>"},{"location":"ansible/ansibleconf/#mis-on-ansiblecfg","title":"Mis on <code>ansible.cfg</code>?","text":"<p><code>ansible.cfg</code> on Ansible\u2019i seadistusfail, millega juhid vaikimisi k\u00e4itumist (inventory asukoht, rollide teed, v\u00e4ljundi formaat, \u00fchenduse s\u00e4tted jpm).</p> <p>Otsinguj\u00e4rjekord (k\u00f5rgeim \u2192 madalaim):</p> <ol> <li>K\u00e4esoleva t\u00f6\u00f6kausta fail <code>ansible.cfg</code> (soovitatav asukoht)</li> <li><code>~/.ansible.cfg</code> (kasutajaprofiili tasemel)</li> <li><code>/etc/ansible/ansible.cfg</code> (s\u00fcsteemne, kui kaust olemas)</li> </ol> <p>Kontrolli, millist faili kasutatakse:</p> <pre><code>ansible --version\n</code></pre> <p>Tulemusest on n\u00e4ha config faili asukoht real:</p> <p><pre><code>    config file = \n</code></pre> Kui \u00fcldakse et <code>no config</code>, siis ei suutnud Ansible sedistusfaili asukohta leida ja fail tuleb ise luua.</p>"},{"location":"ansible/ansibleconf/#seadistusfaili-soovitatav-asukoht","title":"Seadistusfaili soovitatav asukoht","text":"<p>Soovitav ongi peale Ansible paigaldust luua projektikaust ja sinna <code>ansible.cfg</code>, kus asuvad selle projekti p\u00f5hised Ansible seaded. N\u00e4iteks:</p> <pre><code>~/myproject/\n\u251c\u2500 ansible.cfg\n</code></pre>"},{"location":"ansible/ansibleconf/#naidis-ansiblecfg-koos-levinumate-seadetega","title":"N\u00e4idis <code>ansible.cfg</code> koos levinumate seadetega","text":"<p>J\u00e4rgnevalt on esitatud \u00fche <code>ansible.cfg</code> faili sisu koos levinumate parameetritega. Kopeeri vajadusel oma projekti ja kohanda.</p> <pre><code>[defaults]\n# Inventory asukoht (v\u00f5ib olla YAML v\u00f5i INI) ja v\u00f5b viidata ka ainult kautale inventory/ kui kasutatakse mitut inventory faili.\ninventory = inventory/hosts.yaml\n\n# Rollide otsinguteed (projekti 'roles' kaust eespool)\nroles_path = roles:~/.ansible/roles:/usr/share/ansible/roles\n\n# Salvestame retry-faile? Tavaliselt mitte. Vaikimisi, kui playbooki k\u00e4ivitamine mingil p\u00f5hjusel eba\u00f5nnestub m\u00f5ne hosti puhul, loob Ansible sinu t\u00f6\u00f6kausta (v\u00f5i m\u00e4\u00e4ratud kausta) nn *retry-faili*, mille faili l\u00f5pp on .retry. See fail sisaldab **nimekirja hostidest, kus playbook eba\u00f5nnestus**. Selle eesm\u00e4rk on, et saad j\u00e4rgmise k\u00e4suga uuesti k\u00e4ivitada playbooki ainult nende probleemsete hostide peal. N: ansible-playbook site.yml --limit @site.retry\nretry_files_enabled = False\n\n# V\u00e4henda 'host key checking' probleeme katsetamisel. Production keskkonnas v\u00f5id selle uuesti True peale panna.\nhost_key_checking = False\n\n# Kogume fakte (facts) targalt (v\u00e4hem m\u00fcra ja kiiremini kui alati). Nendest on r\u00e4\u00e4gitud playbookide materjalis.\ngathering = smart\n\n# Faktide vahem\u00e4lu - lubada vastavalt vajadusele (kiirendab playbooke suuremas keskkonnas)\n# fact_caching = jsonfile\n# fact_caching_connection = .ansible_cache\n# fact_caching_timeout = 7200\n\n# Mitu paralleelset \u00fchendust (vaikimisi 5). Laboris 10\u201320 on ok.\nforks = 10\n\n# \u00dcldine mooduli/\u00fchenduse timeout sekundites\ntimeout = 30\n\n# Python-t\u00f5lgi automaatne tuvastus (hea heterogeensetes s\u00fcsteemides). Kaotab \u00e4ra Warning teated, mis on seotud Pythoni tuvastamisega.\ninterpreter_python = auto_silent\n\n# L\u00fclita v\u00e4lja l\u00f5bus lehm :), vajadusel. Ansible suudab vaikimisi kuvada teatud s\u00f5numeid ja hoiatusi cowsay stiilis (lehmakujuline ASCII-kunst), kui s\u00fcsteemis on paigaldatud `cowsay` pakett.\nnocows = 1\n\n# Faili diffitamine  lubada vastavalt vajadusele (need seaded aitavad j\u00e4lgida failide muutusi, eriti mallide ja konfiguratsioonifailide puhul.)\n# diff_always = True\n# diff_ignore_lines = ^#\n\n[privilege_escalation]\n# Vaikimisi sudo kasutus\nbecome_method = sudo\nbecome_ask_pass = False   # Kui vajad parooli, kasuta Ansible k\u00e4su l\u00f5pus --ask-become-pass\n\n[ssh_connection]\n# SSH pipelining kiirendab oluliselt. V\u00e4hendab SSH \u00fchenduse kaudu tehtavaid \u00fchenduse loomisi ja sulgemisi - suurte \u00fclesannete jaoks kiirem. Vajab sudoers faili muutmist 'sudo visudo' ja lisada faili 'Defaults:student !use_pty' (kui kasutajanimeks on student) \n#pipelining = True\n\n# Stabiilsem control_path erinevate s\u00fcsteemidega - kasuta kui n\u00e4ed file name too long teateid.\ncontrol_path = %(directory)s/%%h-%%p-%%r\n\n# 1\u20132 paralleelset \u00fcritust \u00fche hosti kohta (vaikimisi 5) \u2013 laboris ok j\u00e4tta default\n# ssh_args = -o ControlMaster=auto -o ControlPersist=60s\n\n# Kui kasutad teistsuguseid v\u00f5tmeid/porti, v\u00f5id lisada:\n# ssh_extra_args = -o StrictHostKeyChecking=no\n</code></pre>"},{"location":"ansible/ansibleconf/#kokkuvotvad-selgitused-olulisematele-satetele","title":"Kokkuv\u00f5tvad selgitused olulisematele s\u00e4tetele","text":"<ul> <li>inventory \u2013 viitab projekti inventory failile/kaustale, ei pea iga kord <code>-i</code> kasutama.</li> <li>roles_path \u2013 m\u00e4\u00e4rab rollide otsinguteed; esimesena projekti <code>roles/</code>.</li> <li>retry_files_enabled = False \u2013 ei tekita <code>*.retry</code> faile (labos harilikult pole vaja).</li> <li>host_key_checking = False \u2013 lihtsustab labos esmakontakti; tootmises pane True.</li> <li>gathering = smart \u2013 kogub fakte optimaalselt, mitte iga kord t\u00e4ismahus.</li> <li>fact_caching \u2013 kui on palju hoste, l\u00fclita sisse (nt <code>jsonfile</code>) ja m\u00e4\u00e4ra kaust.</li> <li>forks \u2013 paralleelsus; t\u00f5stab kiirust, kuid \u00e4ra koorma VM hosti \u00fcle.</li> <li>interpreter_python = auto_silent \u2013 Ansible leiab ise \u00f5ige Pythoni (py2/py3/virt).</li> <li>become plokk \u2013 m\u00e4\u00e4rab sudo kasutamise vaikimisi.</li> <li>pipelining = True \u2013 v\u00e4hendab SSH round-trip\u2019e; v\u00f5ib vajada sudoers seadistust.</li> <li>control_path \u2013 l\u00fchem/\u00fchtlasem SSH control socketi tee (v\u00e4ltimaks \u201ctoo long\u201d vigu).</li> </ul> <p>Kui soovid kiiresti vaadata, mis on konfiguratsioonis muudetud v\u00f5rreldes vaikimisi s\u00e4tetega, siis selleks on eraldi k\u00e4sk:</p> <pre><code>ansible-config dump --only-changed\n</code></pre>"},{"location":"ansible/ansibleconf/#hea-tava","title":"Hea tava","text":"<ul> <li>Hoia <code>ansible.cfg</code> projekti tasemel.</li> <li>Kui on olemas globaalne fail <code>/etc/ansible/ansible.cfg</code>, siis v\u00e4ldi selle muutmist.</li> <li>Kontrolli muudatusi k\u00e4suga <code>ansible-config dump --only-changed</code>.</li> <li>P\u00f6\u00f6ra t\u00e4helepanu turvalisusele: \u00e4ra j\u00e4ta production keskkonnas <code>host_key_checking=False</code> ja v\u00e4ldi salas\u00f5nade hoidmist selges tekstis (kasuta Ansible Vault).</li> </ul>"},{"location":"ansible/ansibleconf/#rohkem-infot","title":"Rohkem infot","text":"<ul> <li>Ansible Configuration File Documentation</li> <li>ansible-config k\u00e4su juhend</li> <li>Ansible Best Practices</li> <li>Performance Tuning</li> </ul>"},{"location":"ansible/ansiblefinal/","title":"Projektip\u00f5hine l\u00f5ppharjutus","text":"<p>Sisu tuleb siia.</p>"},{"location":"ansible/ansiblegalaxy/","title":"Ansible Galaxy Collections","text":""},{"location":"ansible/ansiblegalaxy/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Mis on collections ja miks neid kasutatakse</li> <li>Kuidas otsida ja paigaldada collections Ansible Galaxy'st</li> <li>Kuidas kasutada collection\u2019is olevaid rolle ja mooduleid</li> <li>Kuidas hallata collection\u2019e requirements.yml failiga</li> </ul>"},{"location":"ansible/ansiblegalaxy/#mis-on-collections","title":"Mis on collections?","text":"<p>Collections on uuem viis Ansible\u2019i sisu jagamiseks ja haldamiseks. Kui rollid on m\u00f5eldud \u00fche konkreetse konfiguratsiooni jaoks (nt nginx v\u00f5i mysql), siis collection v\u00f5ib sisaldada:</p> <ul> <li>mitut rolli,</li> <li>Ansible mooduleid ja pluginaid,</li> <li>playbooke ja dokumentatsiooni.</li> </ul> <p>Collections aitab hoida seotud komponente koos ja v\u00f5imaldavad neid lihtsamalt uuesti kasutada.</p> <p>N\u00e4iteks: - <code>community.general</code> sisaldab k\u00fcmneid mooduleid ja rolle erinevate s\u00fcsteemide jaoks. - <code>ansible.posix</code> pakub mooduleid ja pluginaid Linuxi keskkondadele.</p>"},{"location":"ansible/ansiblegalaxy/#collectioni-paigaldamine-ansible-galaxyst","title":"Collection\u2019i paigaldamine Ansible Galaxy\u2019st","text":"<p>Ansible Galaxy on keskkond, kust saab alla laadida nii rolle kui ka collections.</p> <p>Otsi collection\u2019e:</p> <pre><code>ansible-galaxy collection search wordpress\n</code></pre> <p>Paigalda collection:</p> <pre><code>ansible-galaxy collection install iamgini.wordpress\n</code></pre> <p>See paigaldab collection\u2019i vaikimisi asukohta:</p> <pre><code>~/.ansible/collections/ansible_collections/iamgini/wordpress/\n</code></pre> <p>Kui soovid, et collection salvestuks projekti kausta, kasuta <code>-p</code>:</p> <pre><code>ansible-galaxy collection install -p collections iamgini.wordpress\n</code></pre> <p>Kaustastruktuur n\u00e4eb v\u00e4lja umbes nii:</p> <pre><code>myproject/\n\u251c\u2500\u2500 playbook.yml\n\u2514\u2500\u2500 collections/\n    \u2514\u2500\u2500 ansible_collections/\n        \u2514\u2500\u2500 iamgini/\n            \u2514\u2500\u2500 wordpress/\n</code></pre> <p>Info</p> <p>Collection\u2019e ei paigaldata <code>roles/</code> kausta \u2013 need elavad eraldi struktuuris.</p>"},{"location":"ansible/ansiblegalaxy/#collectionis-olevate-rollide-ja-moodulite-kasutamine","title":"Collection\u2019is olevate rollide ja moodulite kasutamine","text":"<p>Collection v\u00f5ib sisaldada nii rolle kui mooduleid.</p>"},{"location":"ansible/ansiblegalaxy/#rolli-kasutamine-playbookis","title":"Rolli kasutamine playbook\u2019is","text":"<p>Kui collection sisaldab rolli, kasutatakse seda t\u00e4isnimega (FQCN \u2013 Fully Qualified Collection Name):</p> <pre><code>---\n- hosts: web\n  become: yes\n  roles:\n    - iamgini.wordpress.wordpress\n</code></pre>"},{"location":"ansible/ansiblegalaxy/#mooduli-kasutamine-playbookis","title":"Mooduli kasutamine playbook\u2019is","text":"<p>Collection\u2019is olevat moodulit saab kutsuda FQCN nimega:</p> <pre><code>- name: Luba 80/tcp tulem\u00fc\u00fcris\n  community.general.ufw:\n    rule: allow\n    port: \"80\"\n</code></pre> <p>V\u00f5i lisada playbook\u2019i algusesse <code>collections:</code> plokk ja kasutada l\u00fchemat nimekuju:</p> <pre><code>---\n- hosts: all\n  collections:\n    - community.general\n  tasks:\n    - name: Luba 80/tcp tulem\u00fc\u00fcris\n      ufw:\n        rule: allow\n        port: \"80\"\n</code></pre>"},{"location":"ansible/ansiblegalaxy/#collectionide-haldamine","title":"Collection\u2019ide haldamine","text":"<p>K\u00f5ik paigaldatud collections n\u00e4ed k\u00e4suga:</p> <pre><code>ansible-galaxy collection list\n</code></pre> <p>Uuendamine:</p> <pre><code>ansible-galaxy collection install --force iamgini.wordpress\n</code></pre> <p>Eemaldamine:</p> <pre><code>ansible-galaxy collection remove iamgini.wordpress\n</code></pre>"},{"location":"ansible/ansiblegalaxy/#collectionide-automaatne-paigaldamine-requirementsyml-failiga","title":"Collection\u2019ide automaatne paigaldamine <code>requirements.yml</code> failiga","text":"<p>Kui projektis kasutatakse mitut collection\u2019it, saad need hallata sama moodi nagu rolle.</p>"},{"location":"ansible/ansiblegalaxy/#naide-requirementsyml-failist","title":"N\u00e4ide <code>requirements.yml</code> failist:","text":"<pre><code>collections:\n  - name: iamgini.wordpress\n  - name: community.general\n  - name: ansible.posix\n</code></pre>"},{"location":"ansible/ansiblegalaxy/#paigalda-koik-korraga","title":"Paigalda k\u00f5ik korraga:","text":"<pre><code>ansible-galaxy collection install -r requirements.yml\n</code></pre> <p>Kui soovid, et need l\u00e4heks projekti kausta:</p> <pre><code>ansible-galaxy collection install -r requirements.yml -p collections\n</code></pre>"},{"location":"ansible/ansiblegalaxy/#uuenda-koiki-olemasolevaid","title":"Uuenda k\u00f5iki olemasolevaid:","text":"<pre><code>ansible-galaxy collection install -r requirements.yml --force\n</code></pre>"},{"location":"ansible/ansiblegalaxy/#rollid-vs-collections-luhivordlus","title":"Rollid vs Collections \u2013 l\u00fchiv\u00f5rdlus","text":"Omadus Rollid Collections Sisaldab \u00dchte rolli Mitut rolli, mooduleid, pluginaid Asukoht <code>roles/</code> <code>~/.ansible/collections/</code> v\u00f5i <code>collections/</code> Installimine <code>ansible-galaxy install</code> <code>ansible-galaxy collection install</code> Kasutamine <code>roles:</code> all <code>roles:</code> v\u00f5i <code>collections:</code> all N\u00f5uete fail <code>requirements.yml</code> (rollid) <code>requirements.yml</code> (collections)"},{"location":"ansible/ansiblegalaxy/#rohkem-infot","title":"Rohkem infot","text":"<ul> <li>Ansible Collections Documentation</li> <li>Ansible Galaxy Collections</li> </ul>"},{"location":"ansible/ansiblehandlers/","title":"Tegevuste k\u00e4ivitamine ainult vajadusel","text":""},{"location":"ansible/ansiblehandlers/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Mis on handler ja millal seda kasutatakse  </li> <li>Kuidas t\u00f6\u00f6tab <code>notify</code> mehhanism  </li> <li>Kuidas handler k\u00e4ivitub ainult siis, kui midagi muutus  </li> <li>Kuidas kasutada mitut handlerit \u00fches playbookis  </li> </ul>"},{"location":"ansible/ansiblehandlers/#mis-on-handler","title":"Mis on handler?","text":"<p>Sageli on vaja k\u00e4ivitada p\u00e4rast m\u00f5ne \u00fclesande t\u00e4itmist lisategevus (nt teenuse taask\u00e4ivitus). Handler on Ansible\u2019i eriline \u00fclesanne (task), mis k\u00e4ivitatakse ainult siis, kui seda teavitatakse (<code>notify</code>) abil. Seda kasutatakse tavaliselt olukorras, kus mingi muudatus n\u00f5uab j\u00e4rgnevat tegevust \u2014 n\u00e4iteks teenuse taask\u00e4ivitust p\u00e4rast konfiguratsioonifaili muutmist.</p> <p>Handlerid asuvad playbooki l\u00f5pus ja n\u00e4evad v\u00e4lja peaaegu nagu tavalised \u00fclesanded, kuid need kuuluvad eraldi plokki nimega <code>handlers:</code>.</p>"},{"location":"ansible/ansiblehandlers/#notify-ja-handleri-toopohimote","title":"Notify ja handleri t\u00f6\u00f6p\u00f5him\u00f5te","text":"<p>Kui tavap\u00e4rane task muudab midagi (nt paigaldab paketi, muudab faili, kirjutab malli jms), saab see anda m\u00e4rku handlerile, kasutades v\u00f5tmes\u00f5na <code>notify:</code>.</p> <p>Handler k\u00e4ivitatakse ainult siis, kui muutus tegelikult toimus \u2014 mitte igal playbooki k\u00e4ivitamisel.  </p> <p>N\u00e4ide: Muudame malli kaudu veebiserveri seadeid ja k\u00e4ivitame veebiserveri kui failis toimus muutus:</p> <pre><code>---\n- name: Nginx konfiguratsiooni uuendamine\n  hosts: webservers\n  become: yes\n\n  tasks:\n    - name: Kopeeri nginx konfiguratsioonimall\n      template:\n        src: templates/nginx.conf.j2\n        dest: /etc/nginx/nginx.conf\n        mode: \"0644\"\n      notify: Taask\u00e4ivita nginx   # Anname handlerile m\u00e4rku, kui faili muudeti\n\n  handlers:\n    - name: Taask\u00e4ivita nginx   # handleri k\u00e4ivitumine ainult muutuse korral\n      service:\n        name: nginx\n        state: restarted\n</code></pre> <p>Selgitus:</p> <ul> <li><code>template</code> moodul kopeerib mallifaili sihtkohta ja v\u00f5rdleb seda olemasolevaga.  </li> <li>Kui sisu erineb, m\u00e4rgib Ansible taski changed olekusse ja k\u00e4ivitab <code>notify</code>.  </li> <li>Handler ei k\u00e4ivitu kohe, vaid playbooki l\u00f5pus \u2013 p\u00e4rast k\u00f5igi taskide t\u00e4itmist.  </li> <li>Kui midagi ei muutunud, handlerit ei k\u00e4ivitata.  </li> </ul> <p>Handler k\u00e4ivitub ainult siis, kui:</p> <ol> <li>Seda on teavitatud (<code>notify:</code>), ja</li> <li>Teavituse andnud task muutus (changed) olekusse.</li> </ol> <p>N\u00e4iteks:</p> <ul> <li>Kui mallifail oli juba ajakohane \u2192 no change \u2192 handler ei t\u00f6\u00f6ta.  </li> <li>Kui mallifail muutus \u2192 changed \u2192 handler k\u00e4ivitatakse playbooki l\u00f5pus.  </li> </ul> <p>See tagab, et teenus taask\u00e4ivitatakse ainult siis, kui see on t\u00f5esti vajalik.  </p>"},{"location":"ansible/ansiblehandlers/#mitme-handleri-kasutamine","title":"Mitme handleri kasutamine","text":"<p>\u00dcks task saab <code>notify:</code> abil teavitada ka mitut handlerit korraga. Seda tehakse <code>notify:</code> all loendina:</p> <pre><code>tasks:\n  - name: Uuenda rakenduse konfiguratsioon\n    template:\n      src: templates/app.conf.j2\n      dest: /etc/myapp/app.conf\n    notify:\n      - Taask\u00e4ivita rakendus\n      - Logi muudatus\n\nhandlers:\n  - name: Taask\u00e4ivita rakendus\n    service:\n      name: myapp\n      state: restarted\n\n  - name: Logi muudatus\n    debug:\n      msg: \"Rakenduse konfiguratsioon uuendati ja teenus taask\u00e4ivitati.\"\n</code></pre> <p>Selgitus:</p> <ul> <li>Kui task muudab midagi, kutsutakse m\u00f5lemad handlerid.  </li> <li>Kui midagi ei muutunud, ei teavitata \u00fchtegi handlerit.  </li> <li>Handlerid k\u00e4ivitatakse j\u00e4rjekorras, milles need on m\u00e4\u00e4ratud.</li> </ul>"},{"location":"ansible/ansiblehandlers/#handlerite-korduvkasutus","title":"Handlerite korduvkasutus","text":"<p>Kui mitu taski kasutab sama handlerit, kutsutakse see ainult \u00fcks kord isegi siis, kui teda teavitati mitu korda.</p> <p>N\u00e4ide:</p> <pre><code>tasks:\n  - name: Uuenda nginx.conf\n    template:\n      src: templates/nginx.conf.j2\n      dest: /etc/nginx/nginx.conf\n    notify: Taask\u00e4ivita nginx\n\n  - name: Uuenda vhosti konfiguratsioonid\n    template:\n      src: templates/vhost.conf.j2\n      dest: /etc/nginx/sites-available/default.conf\n    notify: Taask\u00e4ivita nginx\n\nhandlers:\n  - name: Taask\u00e4ivita nginx\n    service:\n      name: nginx\n      state: restarted\n</code></pre> <p>Ansible ei taask\u00e4ivita teenust kaks korda! Kui mitu taski teavitab sama handlerit, lisatakse see vaid \u00fchte \u201ej\u00e4rjekorda\u201c ja k\u00e4ivitatakse \u00fcks kord playbooki l\u00f5pus.  </p>"},{"location":"ansible/ansiblehandlers/#handlerite-kasitsi-kaivitamine","title":"Handlerite k\u00e4sitsi k\u00e4ivitamine","text":"<p>Vaikimisi k\u00e4ivitatakse k\u00f5ik handlerid playbooki l\u00f5pus. Kui on vaja k\u00e4ivitada need kohe p\u00e4rast teatud taski, saab kasutada:</p> <pre><code>- name: K\u00e4ivita handlerid kohe\n  meta: flush_handlers\n</code></pre> <p>N\u00e4iteks:</p> <pre><code>tasks:\n  - name: Uuenda nginx konfiguratsioon\n    template:\n      src: templates/nginx.conf.j2\n      dest: /etc/nginx/nginx.conf\n    notify: Taask\u00e4ivita nginx\n\n  - name: K\u00e4ivita handler kohe p\u00e4rast muudatust\n    meta: flush_handlers\n\n  - name: Kontrolli, kas nginx t\u00f6\u00f6tab\n    shell: systemctl status nginx\n\nhandlers:\n  - name: Taask\u00e4ivita nginx\n    service:\n      name: nginx\n      state: restarted\n</code></pre>"},{"location":"ansible/ansiblehandlers/#rohkem-infot","title":"Rohkem infot","text":"<ul> <li>Ansible Handlers (Playbook Guide) </li> <li>Using <code>meta: flush_handlers</code> </li> </ul>"},{"location":"ansible/ansibleinstall/","title":"Ansible paigaldamine","text":""},{"location":"ansible/ansibleinstall/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Millised on erinevad Ansible paigaldumeetodid</li> <li>Kuidas Ansible't paigalda</li> <li>Kuhu salvestada Ansible failid</li> </ul>"},{"location":"ansible/ansibleinstall/#eeldused","title":"Eeldused","text":"<p>Ansible\u2019i saab paigaldada erinevatele Linuxi distributsioonidele ja WSL-ile (Windows Subsystem for Linux). Ilma WSL-ita Windowsit ei toetata.</p> <p>N\u00f5uded: </p> <ul> <li>Linuxi distributsioon (nt Debian, Ubuntu, CentOS, Fedora, Arch v\u00f5i WSL)</li> <li>Interneti\u00fchendus</li> <li>Administraatori (root) \u00f5igused</li> <li>Python 3 (tavaliselt on see juba olemas)</li> </ul> <p>Meie vaatame t\u00e4psemalt paigaldust Debiani virtuaalmasinale. Ametliku dokumentatsiooni paigalduse kohta erienevatele Linuxi distributsioonidele leiad siit.</p>"},{"location":"ansible/ansibleinstall/#ansible-paigaldamine-debianile","title":"Ansible paigaldamine Debianile","text":"<p>Debiani paketihalduris olev Ansible versioon on enamasti aegunud. Soovitus on paigaldada v\u00e4rskeim versiooni Ansible\u2019i ametlikust PPA-st (Personal Package Archive), pipx-i v\u00f5i pip-i kaudu (<code>pip</code> - Pythoni standardne pakihaldur, <code>pipx</code> - pip\u2019i peale ehitatud t\u00f6\u00f6riist, mille eesm\u00e4rk on paigaldada Pythoni k\u00e4surea rakendusi isoleeritult, nii et iga rakendus jookseb oma virtuaalkeskkonnas).</p> <ul> <li>Paketihaldur: hea valik \u00fcldiseks kasutamiseks, kus uusim versioon pole kriitiline.</li> <li>pipx / pip: sobib h\u00e4sti arenduseks ja testimiseks, kui soovitakse uusimaid v\u00f5imalusi ning eraldatud keskkonda.</li> </ul>"},{"location":"ansible/ansibleinstall/#1-paigaldamine-apt-pakihalduri-kaudu-ansiblei-ppa-st","title":"1. Paigaldamine APT pakihalduri kaudu Ansible'i PPA-st","text":"<p>Debiani kasutajatel tuleb lisada k\u00fclge Ubuntu PPA.</p> <p>Info</p> <p>Tegemist on Ansible ametliku PPA-ga, aga mitte Debiani ametliku PPA-ga. Debiani ametlik backports on alternatiiv, kui ei soovita Ubuntu PPA-d kasutada.</p> <p>Debian 12/13 kasutajad saavad kasutada Ubuntu 24.04 PPA-d mille koodnimeks on <code>noble</code>. Ansible paigaldub j\u00e4rgmiste k\u00e4skude abil:</p> <p><pre><code>UBUNTU_CODENAME=noble\n\nwget -O- \"https://keyserver.ubuntu.com/pks/lookup?fingerprint=on&amp;op=get&amp;search=0x6125E2A8C77F2818FB7BD15B93C4A3FD7BB9C367\" | sudo gpg --dearmour -o /usr/share/keyrings/ansible-archive-keyring.gpg\n\necho \"deb [signed-by=/usr/share/keyrings/ansible-archive-keyring.gpg] http://ppa.launchpad.net/ansible/ansible/ubuntu $UBUNTU_CODENAME main\" | sudo tee /etc/apt/sources.list.d/ansible.list\n\nsudo apt update &amp;&amp; sudo apt install ansible\n</code></pre> Selliselt paigaldatud Ansible eeliseks on see, et see on uuendatav pakihalduri abil.</p>"},{"location":"ansible/ansibleinstall/#2-paigaldamine-pipx-abil-sobib-peaaegu-igale-linuxile","title":"2. Paigaldamine <code>pipx</code> abil (sobib peaaegu igale Linuxile)","text":"<p>Debianil pole <code>pipx</code> veel tavaliselt paigaldatud, seega paigaldame k\u00f5igepealt selle: <pre><code>sudo apt install pipx -y\n</code></pre></p> <p>N\u00fc\u00fcd paigaldame Ansible ja lisame selle teekonna ka s\u00fcsteemsete k\u00e4skude hulka ja kontrollime: <pre><code>pipx install --include-deps ansible\npipx ensurepath\n</code></pre></p> <p>Info</p> <p><code>--include-deps</code> on oluline, sest ilma selleta j\u00e4etakse osad t\u00f6\u00f6riistad paigaldamata.</p> <p>Peale selle logi korra kasutajast v\u00e4lja ja uuesti sisse muidu Ansible k\u00e4sud otse ei t\u00f6\u00f6ta.</p> <p>Tulevikus saab sellist paigaldust uuendada j\u00e4rgmiselt: <pre><code>pipx upgrade --include-injected ansible\n</code></pre></p>"},{"location":"ansible/ansibleinstall/#3-paigaldamine-pip-abil","title":"3. Paigaldamine <code>pip</code> abil","text":"<p>Info</p> <p>Debian 12+ ja teised uuemad distributsioonid nagu Ubuntu 23.04+ j\u00e4rgivad standardit, mis kaitseb s\u00fcsteemset Pythonit juhusliku s\u00fcsteemi rikkumise eest. Seet\u00f5ttu midagi <code>pip</code> abil paigaldades antakse veateade \"externally-managed environment\". Ehk s\u00fcsteemi haldab APT pakihaldur ja sinna ei tohiks isegi kasutaja tasmele enam pip abil pakette paigaldada.</p> <p>Soovituslik on kasutada virtuaalset keskkonda. J\u00e4rgnevalt paigaldame keskkonna loomiseks vajaliku paki ja loome uue virtuaalse keskkonna nimega ansible-venv. Seej\u00e4rel paigaldame sinna Ansible (virtuaalne keskkond on isoleeritud Python'i keskkond, kus saab paigaldada s\u00f5ltuvusi ilma s\u00fcsteemi tasemel muudatusi tegemata):</p> <pre><code>apt install python3-venv\npython3 -m venv ansible-venv\nsource ansible-venv/bin/activate\npip install ansible\n</code></pre> <p>Selliselt paigaldatud Ansible puhul on vaja iga kord sisse logides virtuaalkeskkond uuesti k\u00e4ivitada: <pre><code>source ansible-venv/bin/activate\n</code></pre></p>"},{"location":"ansible/ansibleinstall/#versiooni-kontroll","title":"Versiooni kontroll","text":"<pre><code>ansible --version\n</code></pre> <p>See n\u00e4itab Ansible'i versiooni ja ka seda, kust ta on paigaldatud (pip, pakihaldur jne).</p>"},{"location":"ansible/ansibleinstall/#kas-ansible-tootab-esimene-test","title":"Kas Ansible t\u00f6\u00f6tab? \u2013 esimene test","text":"<pre><code>ansible localhost -m ping\n</code></pre> <p>Kui k\u00f5ik on korras, peaksid n\u00e4gema midagi sellist: <pre><code>localhost | SUCCESS =&gt; {\n    \"changed\": false,\n    \"ping\": \"pong\"\n}\n</code></pre></p> <p>See t\u00e4hendab, et Ansible t\u00f6\u00f6tab sinu enda masina (localhost) peal.</p>"},{"location":"ansible/ansibleinstall/#tuupilised-probleemid","title":"T\u00fc\u00fcpilised probleemid","text":"Probleem Lahendus <code>ansible: command not found</code> Kontrolli, kas paigaldus \u00f5nnestus ja kas PATH sisaldab pipi <code>--user</code> kausta v\u00f5i kas virtuaalkeskkond on aktiveeritud. <code>Permission denied</code> Kasutasid k\u00e4sku ilma <code>sudo</code>-ta? V\u00f5i SSH-\u00fchendusel puuduvad \u00f5igused? Python puudub Paigalda Python: <code>sudo apt install python3</code>."},{"location":"ansible/ansibleinstall/#kuhu-salvestada-ansible-failid","title":"Kuhu salvestada Ansible failid?","text":"<p>Ansible t\u00f6\u00f6tab v\u00e4ga paindlikult \u2014 faile v\u00f5id hoida erinevates kohtades, s\u00f5ltuvalt sellest, kuidas Ansible paigaldasid ja millist struktuuri projektile soovid. Allj\u00e4rgnevalt m\u00f5ned juhised ja soovitused.</p> Paigaldusmeetod M\u00f5ju / muutused APT pakihaluri kaudu paigaldades (nt Ubuntu PPA) Ansible installitakse s\u00fcsteemi tasemel PATH-i. Varasemad versioonid l\u00f5id kausta <code>/etc/ansible/</code> ja ka alamkausta <code>roles/</code>. Viimased versioonid enam automaatselt <code>/etc/ansible/</code> kausta ei loo, pead ise sobivasse kohta projektikausta looma ja seadeid haldama <code>ansible.cfg</code> kaudu. pip / pipx (kasutajap\u00f5hine paigaldus) Ansible programmifailid paigutatakse kasutaja tasemele. Automaatselt <code>/etc/ansible/</code> kausta ei looda, pead ise sobivasse kohta projektikausta looma ja seadeid haldama <code>ansible.cfg</code> kaudu. <p>Ansible faile on seega m\u00f5istlik hoida t\u00e4nap\u00e4evalt projektip\u00f5hiselt eraldi kaustas. Kausta v\u00f5ib luua kodukasuta, n\u00e4iteks:</p> <ul> <li><code>~/ansible/</code></li> <li><code>~/projekti-nimi/</code></li> </ul> <p>Projektikausta struktuuri n\u00e4ide. N\u00e4ites olevate failide ja kaustade otstarbest r\u00e4\u00e4gime eraldi j\u00e4rgnevates materjalides:</p> <pre><code>~/ansible-project/\n\u251c\u2500 ansible.cfg # projekti konfiguratsioon\n\u251c\u2500 inventory/  # projekti inventory kaust\n\u2502 \u251c\u2500 hosts.yaml\n\u2502 \u2514\u2500 group_vars/ # gruppide muutujad\n\u2502 \u2514\u2500 webservers.yml\n\u2502 \u2514\u2500 host_vars/ # hostide muutujad\n\u2502 \u2514\u2500 web1.yml\n\u251c\u2500 templates/ # projekti mallide kaust\n\u2502 \u2514\u2500 nginx.conf.j2\n\u2514\u2500 site.yml\n\u2514\u2500 roles/  # rollide kaust (kui kasutad rolle)\n</code></pre> <p>Info</p> <p>Soovitus on luua iga projekti jaoks eraldi <code>ansible.cfg</code> fail kuhu m\u00e4\u00e4rata selle projekti jaoks vajalikud Ansible seaded.</p>"},{"location":"ansible/ansibleinstall/#rohkem-infot","title":"Rohkem infot","text":"<p>Installing Ansible Installing Ansible on specific operating systems</p>"},{"location":"ansible/ansibleintro/","title":"Ansible \u00fclevaade","text":""},{"location":"ansible/ansibleintro/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Mis on Ansible</li> <li>Kuidas Ansible t\u00f6\u00f6tab</li> <li>Kuidas Ansible't kasutada</li> </ul>"},{"location":"ansible/ansibleintro/#mis-on-ansible","title":"Mis on Ansible?","text":"<p>Kujuta ette, et sul on k\u00fcmneid v\u00f5i isegi sadu servereid, mida pead seadistama, uuendama v\u00f5i millele lisama tarkvara, lisama uusi kasutajaid, muutma paroole. K\u00e4sitsi tehes oleks see t\u00fc\u00fctu ja aegan\u00f5udev t\u00f6\u00f6. Siin tuleb appi Ansible.</p> <p>Ansible on tasuta ja avatud l\u00e4htekoodiga t\u00f6\u00f6riist, mis aitab automatiseerida IT-s\u00fcsteemide haldamist. Selle abil saad \u00fche k\u00e4suga teha muudatusi sadades serverites. Ansible on \"agentless\" t\u00f6\u00f6riist, mis t\u00e4hendab, et hallatavatesse seadmetesse ei pea paigaldama \u00fchtegi lisaprogrammi. K\u00f5ik toimub \u00fcle SSH (Linuxi ja Windowsi puhul) v\u00f5i WinRM-i (Windowsi puhul, kui SSH pole kasutusel). Hallatavates Linuxi masinates peab olema ainult SSH ja Python, Windowsi puhul kas WinRM v\u00f5i OpenSSH-server.</p> <p>Ansible arendajaks on Red Hat, mis omandas Ansible 2015. aastal. Kuigi Red Hat pakub ka Ansible\u2019ile tuge ja t\u00e4iendavaid t\u00f6\u00f6riistu (n\u00e4iteks Red Hat Ansible Automation Platform), on Ansible\u2019i p\u00f5hiversioon ja paljud selle komponendid avatud l\u00e4htekoodiga ja k\u00f5igile tasuta k\u00e4ttesaadavad. Sellesse panustavad ka paljud teised arendajad ja IT-spetsialistid \u00fcle maailma.</p>"},{"location":"ansible/ansibleintro/#milleks-ansible-kasulik-on","title":"Milleks Ansible kasulik on?","text":"<ul> <li>Automatiseerib korduvaid t\u00f6id. N\u00e4iteks programmide paigaldamine v\u00f5i seadistuste muutmine.</li> <li>Hoiab k\u00f5ik s\u00fcsteemid \u00fchtemoodi. Kui seadistad midagi \u00fches serveris, saad sama teha k\u00f5igis teistes.</li> <li>S\u00e4\u00e4stab aega. \u00dche k\u00e4suga saab hallata k\u00fcmneid v\u00f5i sadu servereid.</li> <li>V\u00e4hendab vigu. Kui t\u00f6\u00f6 on automatiseeritud, j\u00e4\u00e4b v\u00e4hem ruumi inimlikele eksimustele.</li> <li>Kontrollib enne tegevust. Kui midagi on juba \u00f5igesti seadistatud, j\u00e4tab Ansible selle rahule.</li> <li>Kergesti loetavad juhised. K\u00f5ik seadistused kirjutatakse YAML-formaadis \u2014 lihtne lugeda ka neil, kellel pole palju kogemust programmeerimisega. Tuleb j\u00e4rgida vaid rangeid taandereeglid.</li> </ul> <p>N\u00e4ide elust: Kui pead igal n\u00e4dalal uuendama paroole 30 serveris, v\u00f5id teha selleks \u00fche Ansible playbooki ja t\u00f6\u00f6 on tehtud paari minutiga.</p>"},{"location":"ansible/ansibleintro/#kuidas-ansible-tootab","title":"Kuidas Ansible t\u00f6\u00f6tab?","text":"<p>Ansible koosneb mitmest osast, mis k\u00f5ik aitavad automatiseerimist ellu viia. Vaatame neid l\u00fchidalt:</p> Komponent Mis see on? Control Node (CN) Arvuti, kust Ansible\u2019i k\u00e4sud teele l\u00e4hevad. See on nagu halduskeskus, kust Ansible\u2019i k\u00e4ske ja playbooke k\u00e4ivitatakse ja hallatavaid masinaid kontrollitakse. Managed Nodes Need on k\u00f5ik s\u00fcsteemid, mida Control Node haldab ehk masinad, kuhu Ansible saadab k\u00e4ske ja \u00fclesandeid. Inventory Fail, kuhu pannakse kirja k\u00f5ik hallatavad masinad. Playbook Fail, kus \u00fctled t\u00e4pselt, mida hallatavates masinates tegema peab. Playbookid on Ansible\u2019i skriptid, mis m\u00e4\u00e4ravad \u00fclesannete jada ja nende t\u00e4itmise j\u00e4rjekorra. Need on kirjutatud YAML-formaadis ja m\u00e4\u00e4ravad, milliseid \u00fclesandeid tuleb teatud hostidel t\u00e4ita. Iga playbook koosneb \"playdest\", mis kirjeldavad konkreetset \u00fclesannete kogumit, mida k\u00e4ivitatakse sihtmasinates. Modules Moodulid on nagu t\u00f6\u00f6riistad, mis t\u00e4idavad konkreetseid toiminguid, n\u00e4iteks tarkvara paigaldamine, teenuse taask\u00e4ivitamine v\u00f5i failide kopeerimine. Ansible sisaldab sadu sisseehitatud mooduleid, kuid v\u00f5imaldab ka luua kohandatud mooduleid vastavalt vajadusele. Roles Rollid v\u00f5imaldavad suuremad projekte paremini organiseerida ja koodi taaskasutada. Rollid jagavad \u00fclesanded erinevatesse kaustadesse ja failidesse, n\u00e4iteks tasks, vars, handlers, templates, files. Plugins Laiendused, mis v\u00f5imaldavad Ansible\u2019il teha rohkem: nt logimine, \u00fchenduse seadistamine v\u00f5i tulemuste t\u00f6\u00f6tlemine. Ansible sisaldab sisseehitatud pluginaid, kuid toetab ka kohandatud pluginate loomist. Variables Muutujad hoiavad v\u00e4\u00e4rtusi nagu kasutajanimed, paroolid v\u00f5i muud seaded v\u00f5imaldades konfiguratsioonidesse paindlikkust lisada.  Ansible v\u00f5imaldab m\u00e4\u00e4rata muutujate v\u00e4\u00e4rtusi mitmetel eri tasanditel, n\u00e4iteks globaalsed, rollip\u00f5hised v\u00f5i hostip\u00f5hised muutujad. Templates Mallid on failid, mis kohanduvad vastavalt muutujatele, v\u00f5imaldades d\u00fcnaamilisi konfiguratsioone. Need on tavaliselt kirjutatud Jinja2-s\u00fcntaksis."},{"location":"ansible/ansibleintro/#lihtne-skeem","title":"Lihtne skeem:","text":""},{"location":"ansible/ansibleintro/#_1","title":"Ansible \u00fclevaade","text":""},{"location":"ansible/ansibleintro/#kuidas-ansiblet-kasutada","title":"Kuidas Ansible't kasutada?","text":"<p>Vaatame k\u00f5iki etappe ka j\u00e4rgnevates teemades l\u00e4hemalt, aga l\u00fchike n\u00e4ide, kuidas asnible't kasutada, oleks j\u00e4rgmine:</p> <ol> <li>Paigalda ansible</li> <li>Kirjuta inventuurifail \u2014 n\u00e4iteks <code>hosts.ini</code>, kus loetled k\u00f5ik serverid.</li> <li>Kirjuta playbook \u2014 m\u00e4\u00e4rad, mida igas serveris teha tuleb.</li> <li>K\u00e4ivita Ansible k\u00e4sk \u2014 <code>ansible-playbook -i hosts.ini minu-playbook.yml</code></li> </ol>"},{"location":"ansible/ansibleintro/#naide-inventuurifailist","title":"N\u00e4ide inventuurifailist:","text":"<p>Siin n\u00e4ites kirjeldatakse \u00e4ra 2 veebiserverit.</p> <pre><code>[webservers]\n192.168.1.10\n192.168.1.12\n</code></pre>"},{"location":"ansible/ansibleintro/#naide-playbookist","title":"N\u00e4ide playbookist:","text":"<p>Siin playbookis paigaldatakse k\u00f5igile veebiserveritele peale NGINX.</p> <pre><code>- name: Paigalda NGINX\n  hosts: webservers\n  become: true\n  tasks:\n    - name: Installi NGINX\n      apt:\n        name: nginx\n        state: present\n        update_cache: yes\n</code></pre>"},{"location":"ansible/ansibleintro/#rohkem-infot","title":"Rohkem infot","text":"<p>Getting started with Ansible Ansible concepts</p>"},{"location":"ansible/ansibleinventory/","title":"Ansible inventory","text":""},{"location":"ansible/ansibleinventory/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Mis on Ansible inventory ja miks see on oluline</li> <li>Kuidas luua inventory fail (.INI ja .YAML)</li> <li>Kuidas lisada hoste, gruppe ja muutujaid</li> <li>Kuidas kontrollida ja hallata inventory't</li> </ul>"},{"location":"ansible/ansibleinventory/#mis-on-inventory","title":"Mis on inventory?","text":"<p>Inventory on fail v\u00f5i failide kogum, kus on kirjas hallatavad hostid ja nende omadused. Inventory on Ansible t\u00f6\u00f6de aluseks \u2013 see m\u00e4\u00e4rab, milliste masinate v\u00f5i teenustega Ansible \u00fchendub ja milliseid \u00fclesandeid neile saadetakse. </p> <p>Inventory saab olla loodud:</p> <ul> <li>Staatiliselt \u2013 n\u00e4iteks <code>INI</code> v\u00f5i <code>YAML</code> failina.</li> <li>D\u00fcnaamiliselt \u2013 skripti v\u00f5i plugina kaudu, mis p\u00e4rib hostide info automaatselt (nt pilveteenuse API kaudu).</li> <li>Kombineeritud \u2013 osa hoste on staatilises failis, osa hangitakse d\u00fcnaamiliselt.</li> </ul> <p>Siin vaatame p\u00f5hiliselt staatilist inventory loomist, mida kasutatakse k\u00f5ige enam.</p>"},{"location":"ansible/ansibleinventory/#inventory-faili-formaadid","title":"Inventory faili formaadid","text":""},{"location":"ansible/ansibleinventory/#ini-formaat-lihtsam","title":"INI formaat (lihtsam)","text":"<p>Klassikaline inventory formaat: </p> <ul> <li>Lihtne ja kiire alustada \u2013 sobib h\u00e4sti algajatele, v\u00e4ikeste projektide v\u00f5i testkeskkondade jaoks.</li> <li>V\u00e4hem s\u00fcntaksireegleid \u2013 ei pea muretsema taandete p\u00e4rast (erinevalt YAML-ist).</li> </ul> <p>N\u00e4ide: <pre><code>[webservers]\nweb1.example.com\nweb2.example.com\n192.168.1.23\n192.168.1.6\n\n[dbservers]\ndb1.example.com ansible_user=admin\n</code></pre></p>"},{"location":"ansible/ansibleinventory/#yaml-formaat-soovitatav","title":"YAML formaat (soovitatav)","text":"<p>YAML formaadis inventory faili kasutamisel on mitmeid eeliseid v\u00f5rreldes klassikalise INI-vorminguga, eriti kui \u00f5petad v\u00f5i t\u00f6\u00f6tad suuremate ja keerulisemate Ansible keskkondadega:</p> <ul> <li>Selgem ja loetavam</li> <li>Sobib keerukate struktuuride jaoks</li> <li>Tulevikukindel (Ansible liigub YAML-i suunas)</li> </ul> <p>N\u00e4ide: <pre><code>all:\n  children:\n    webservers:\n      hosts:\n        web1.example.com:\n        web2.example.com:\n      vars:\n        http_port: 80\n    dbservers:\n      hosts:\n        db1.example.com:\n          ansible_host: 192.168.1.50\n</code></pre></p> <p>Warning</p> <p>YAML-is tuleb kasutada taanete jaoks t\u00fchikuid, mitte TAB-e. Vale taandus = viga. Iga j\u00e4rgmise taseme element = j\u00e4rjepidev arv t\u00fchikuid (standardiks 2 t\u00fchikut).</p>"},{"location":"ansible/ansibleinventory/#grupid-ja-vaikimisi-grupid","title":"Grupid ja vaikimisi grupid","text":"<p>Grupp on inventory failis loogiline kogum hoste (servereid), millel on sarnane roll v\u00f5i funktsioon. </p> <p>Gruppide abil saab:</p> <ul> <li>Hallata mitut hosti korraga \u2013 n\u00e4iteks paigaldada sama tarkvara k\u00f5igile veebiserveritele.</li> <li>M\u00e4\u00e4rata \u00fchiseid muutujaid \u2013 n\u00e4iteks ansible_user, ansible_python_interpreter v\u00f5i rakenduse konfiguratsioon.</li> <li>Luua hierarhiaid \u2013 grupp v\u00f5ib sisaldada teisi gruppe (nt all \u2192 webservers ja dbservers).</li> </ul> <p>Ansible lisab automaatselt iga inventory-sse kaks gruppi:</p> <ul> <li><code>all</code> \u2013 sisaldab k\u00f5iki hoste</li> <li><code>ungrouped</code> \u2013 sisaldab hoste, mis ei kuulu \u00fchtegi teise gruppi</li> </ul> <p>See t\u00e4hendab, et ka \u00fcksik host ilmub nii <code>all</code> kui <code>ungrouped</code> nimekirjas. Playbookides saab neid gruppe ka vajadusel kasutada.</p>"},{"location":"ansible/ansibleinventory/#vaikimisi-inventory-fail","title":"Vaikimisi inventory fail","text":"<p>Traditsiooniliselt otsis Ansible inventory't failist: <pre><code>/etc/ansible/hosts\n</code></pre> See ei kehti enam viimaste versioonide ja pip v\u00f5i pipx abil, paigaldatud Ansible puhul:</p> <ul> <li>Kui sa Ansible k\u00e4su puhul <code>-i</code> argumenti ei m\u00e4\u00e4ra ega konfigureeri <code>ansible.cfg</code> faili, on vaikimisi inventory'ks ainult <code>localhost</code></li> <li>S\u00fcsteemne <code>ansible.cfg</code> fail puudub, seega peab seadistuse tegema projekti v\u00f5i kasutaja tasemel ja ise projektikausta vastava faili looma.</li> </ul> <p>Vaikimisi inventory otsimise j\u00e4rjekord:</p> <ol> <li>K\u00e4surea <code>-i</code> argument</li> <li>Keskkonnamuutuja <code>ANSIBLE_INVENTORY</code></li> <li><code>ansible.cfg</code> (projekti kaustas v\u00f5i <code>~/.ansible.cfg</code>)</li> <li>Kui midagi eelnevat pole, kasutatakse ainult <code>localhost</code></li> </ol>"},{"location":"ansible/ansibleinventory/#inventory-kontroll-ja-visualiseerimine","title":"Inventory kontroll ja visualiseerimine","text":"<p><code>ansible-inventory</code> on kasulik inventory kontrollimiseks.</p> <p>N\u00e4ited: <pre><code>ansible-inventory -i inventory.yml --list\nansible-inventory -i inventory.yml --graph\n</code></pre></p> <ul> <li><code>--list</code> \u2013 kuvab kogu inventory JSON-vormingus</li> <li><code>--graph</code> \u2013 n\u00e4itab gruppide ja hostide struktuuri puuna</li> </ul> <p>Konkreetse hosti kohta inventory vaatamine: <pre><code>ansible-inventory -i inventory.yml --host web1.example.com\n</code></pre></p>"},{"location":"ansible/ansibleinventory/#inventory-kataloog-ja-mitme-allika-kasutamine","title":"Inventory kataloog ja mitme allika kasutamine","text":"<p>Inventory ei pea asuma ainult \u00fches failis \u2013 Ansible toetab inventory katalooge, mis v\u00f5imaldavad vajadusel jagada hostide nimekirja mitmeks failiks. Inventory jaoks eraldi kataloogi kasutamine on hea praktika, eriti suuremates projektides. </p> <p>Ansible v\u00f5ib lugeda inventory kataloogi, mis sisaldab mitut faili: <pre><code>inventory/\n\u251c\u2500\u2500 aws.yml\n\u251c\u2500\u2500 azure.yml\n\u251c\u2500\u2500 hosts.ini\n</code></pre> Failid loetakse t\u00e4hestiku j\u00e4rjekorras, mis v\u00f5ib m\u00f5jutada grupisuhted ja muutujate prioriteete. Nagu n\u00e4itest n\u00e4ha on, siis failiformaate v\u00f5ib ka segada.</p>"},{"location":"ansible/ansibleinventory/#hostide-ja-gruppide-muutujad","title":"Hostide ja gruppide muutujad","text":"<p>Muutujad (variables) v\u00f5imaldavad m\u00e4\u00e4rata v\u00e4\u00e4rtusi, mida Ansible kasutab. Need v\u00f5ivad olla n\u00e4iteks:</p> <ul> <li>SSH kasutajanimi (ansible_user)</li> <li>SSH v\u00f5tme asukoht (ansible_ssh_private_key_file)</li> <li>Rakenduse konfiguratsioon (nt http_port, db_name)</li> </ul> <p>Hosti muutujad (host_vars) \u2013 kehtivad ainult \u00fchele hostile. Grupi muutujad (group_vars) \u2013 kehtivad tervele grupile.</p> <p><code>group_vars/</code> ja <code>host_vars/</code> - Kui need kaustad asuvad samas asukohas inventory failiga, loeb Ansible need automaatselt. - Kui inventory on eraldi kataloog, peavad <code>group_vars/</code> ja <code>host_vars/</code> olema esimese taseme alamkaustad.</p> <p>N\u00e4ide: <pre><code>inventory/\n\u251c\u2500\u2500 hosts.yml\n\u251c\u2500\u2500 group_vars/\n\u2502   \u2514\u2500\u2500 web.yml\n\u2514\u2500\u2500 host_vars/\n    \u2514\u2500\u2500 db1.example.com.yml\n</code></pre></p> <p>Inventory faili sees saab samuti saab m\u00e4\u00e4rata muutujaid. N\u00e4ide (<code>INI</code> ja <code>YAML</code>):</p> <pre><code>[web]\nweb1 ansible_user=deploy ansible_port=2222\nweb2 ansible_user=deploy\n\n[web:vars]\nansible_python_interpreter=/usr/bin/python3\n</code></pre> <pre><code>all:\n  children:\n    webservers:\n      hosts:\n        web1:\n          ansible_host: 192.168.1.10\n        web2:\n          ansible_host: 192.168.1.11\n      vars:\n        http_port: 80\n        ansible_python_interpreter: /usr/bin/python3\n</code></pre> <p>Info</p> <p>Kui sama muutuja on m\u00e4\u00e4ratud mitmes kohas, kehtib j\u00e4rgmine prioriteet: host_vars &gt; group_vars &gt; all grupi muutujad.  </p> <p>See t\u00e4hendab, et konkreetsele hostile m\u00e4\u00e4ratud v\u00e4\u00e4rtus kirjutab alati \u00fcle grupis v\u00f5i <code>all</code> grupis m\u00e4\u00e4ratud v\u00e4\u00e4rtuse.</p>"},{"location":"ansible/ansibleinventory/#kuidas-luua-inventoyt-ini-ja-yaml","title":"Kuidas luua inventoy't (INI ja YAML)?","text":"<p>Loo uus fail:</p> <p>Inventory fail v\u00f5ib olla \u00fcksk\u00f5ik millises kaustas, aga tavaliselt hoitakse seda projekti juurkaustas v\u00f5i eraldi <code>inventory/</code> kataloogis. Faili nimi v\u00f5ib olla n\u00e4iteks:</p> <ul> <li><code>hosts.ini</code> (INI-formaat)</li> <li><code>hosts.yml</code> (YAML-formaat)</li> </ul> <p>Lisa hostid ja grupid:</p> <p>INI-formaadis: <pre><code>[webservers]\nweb1.example.com\nweb2.example.com\n\n[dbservers]\ndb1.example.com\n</code></pre></p> <p>YAML-formaadis: <pre><code>all:\n  children:\n    webservers:\n      hosts:\n        web1.example.com:\n        web2.example.com:\n    dbservers:\n      hosts:\n        db1.example.com:\n          ansible_host: 192.168.1.10\n          ansible_port: 2222\n</code></pre></p> <p>Info</p> <ul> <li><code>children</code> YAML inventory failis t\u00e4hendab alamgruppe ehk gruppide sees olevaid gruppe.</li> <li><code>hosts</code> all loetletakse k\u00f5ik selle grupi masinad. Kui hostile on omadusi (nt IP, port), lisatakse need v\u00f5tme-v\u00e4\u00e4rtuse paaridena.</li> </ul> <p>Lisa vajadusel muutujad</p> <pre><code>[webservers:vars]\nansible_user=ubuntu\nansible_ssh_private_key_file=~/.ssh/id_rsa\n</code></pre> <pre><code>all:\n  children:\n    webservers:\n      vars:\n        ansible_user: ubuntu\n        ansible_ssh_private_key_file: ~/.ssh/id_rsa\n</code></pre>"},{"location":"ansible/ansibleinventory/#dunaamiline-inventory","title":"D\u00fcnaamiline inventory","text":"<p>D\u00fcnaamiline inventory loob hostide nimekirja reaalajas (nt pilveteenuse API-st). N\u00e4iteks: - AWS EC2 plugin - Azure RM plugin - OpenStack plugin</p> <p>Eelised: - Hostide nimekiri on alati v\u00e4rske - Ei pea k\u00e4sitsi inventory't uuendama - Saab grupeerida hoste automaatselt metat\u00e4histe (tagide) alusel</p>"},{"location":"ansible/ansibleinventory/#head-tavad-inventory-haldamisel","title":"Head tavad inventory haldamisel","text":"<ul> <li>Hoia inventory versioonihalduses (nt Git), eriti kui tegemist on staatilise failiga.</li> <li>Kasuta gruppe, et v\u00e4ltida k\u00e4skude kogemata valele masinale k\u00e4ivitamist.</li> <li>Erinevate keskkondade jaoks (test, staging, production) tee eraldi inventory failid v\u00f5i kaustad.</li> <li>Kui v\u00f5imalik, automatiseeri inventory loomine (nt d\u00fcnaamilise inventory pluginatega).</li> <li>\u00c4ra salvesta salas\u00f5nu inventory failidesse \u2014 kasuta Ansible Vault-i (vt. t\u00e4psemalt \"Turvalisus ja Ansible Vault\" materjalis).</li> </ul>"},{"location":"ansible/ansibleinventory/#rohkem-infot","title":"Rohkem infot","text":"<p>Ansible Inventory Guide Dynamic Inventory Guide</p>"},{"location":"ansible/ansiblejinja2/","title":"Jinja2 mallid","text":""},{"location":"ansible/ansiblejinja2/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Mis on Jinja2 mallid ja miks neid vaja on</li> <li>Kuidas luua mallifaile</li> <li>Kuidas kasutada mallides muutujaid, tingimusi ja ts\u00fckleid</li> <li>Kuidas kasutada <code>template</code> moodulit mallide paigaldamiseks</li> <li>Kuidas kontrollida malli t\u00f6\u00f6 <code>--check</code> ja <code>--diff</code> abil</li> <li>Head tavad mallide kirjutamisel</li> </ul>"},{"location":"ansible/ansiblejinja2/#mis-on-jinja2-mallid-ja-miks-need-on-kasulikud","title":"Mis on Jinja2 mallid ja miks need on kasulikud","text":"<p>Jinja2 on Ansible vaikimisi kasutatav mallimootor, millega saab d\u00fcnaamiliselt luua konfiguratsioonifaile, skripte v\u00f5i muud sisu.</p> <ul> <li>Mall on tavaline tekstifail (nt konfiguratsioonifail v\u00f5i skript), kus kasutatakse muutujaid ja tingimuslauseid (nt <code>if</code>, <code>for</code>).</li> <li>Faili laiend on tavaliselt <code>.j2</code>.</li> <li>K\u00e4ivitamisel asendab Ansible mallis olevad muutujad nende v\u00e4\u00e4rtustega ning loob sihtmasinas l\u00f5ppfaili.</li> </ul> <p>Enamik serveriteenuseid (nt Nginx, Apache, SSH, MariaDB, Docker jne) vajavad konfiguratsioonifaile, et m\u00e4\u00e4rata nende seadistusi.</p> <p>Kui seadistad servereid k\u00e4sitsi, pead iga teenuse jaoks:</p> <ul> <li>kirjutama v\u00f5i muutma konfiguratsioonifaile,</li> <li>kopeerima need \u00f5igesse kohta (nt <code>/etc/nginx/sites-available/default</code>),</li> <li>tagama, et \u00f5iged v\u00e4\u00e4rtused (nt <code>server_name</code>, pordid, kaustateed) on igas serveris \u00f5iged.</li> </ul> <p>Ansible mallide kasutamine teeb selle lihtsamaks:</p> <ul> <li>Mall (template) on konfiguratsioonifaili alus, kus muutuvad osad (nt <code>server_name</code>, <code>web_root</code>) on kirjutatud muutujatena <code>{{ ... }}</code>.</li> <li>Playbook koos <code>template</code> mooduliga kopeerib malli \u00f5igesse asukohta ja asendab muutujad sihtmasina jaoks sobivate v\u00e4\u00e4rtustega.</li> </ul>"},{"location":"ansible/ansiblejinja2/#lihtne-naide-mallifailist-ja-selle-kasutamisest","title":"Lihtne n\u00e4ide mallifailist ja selle kasutamisest","text":"<p>Fail <code>templates/nginx.conf.j2</code>:</p> <pre><code>server {\n    listen 80;\n    server_name {{ server_name }};\n\n    root {{ web_root }}/html;\n\n    location / {\n        index index.html;\n    }\n}\n</code></pre> <p>Playbook, mis kasutab kasutab seda malli:</p> <pre><code>---\n- name: NGINX konfiguratsiooni loomine mallist\n  hosts: webservers\n  become: yes\n\n  vars:\n    server_name: example.com\n    web_root: /var/www\n\n  tasks:\n    - name: Loo konfiguratsioonifail mallist\n      template:\n        src: nginx.conf.j2\n        dest: /etc/nginx/sites-available/default\n\n    - name: Taask\u00e4ivita nginx\n      service:\n        name: nginx\n        state: restarted\n</code></pre> <p>Selgitus:</p> <ul> <li>Mallifaili muutujad (<code>{{ server_name }}</code> ja <code>{{ web_root }}</code>) asendatakse playbooki jooksutamise ajal nende v\u00e4\u00e4rtustega.</li> <li><code>template:</code> moodul kopeerib mallifaili sihtmasinasse ja teeb asendused.</li> </ul>"},{"location":"ansible/ansiblejinja2/#kataloogistruktuur","title":"Kataloogistruktuur","text":"<p>Praktikas paigutatakse mallid eraldi <code>templates/</code> kataloogi.</p> <p>N\u00e4ide: <pre><code>/etc/ansible/myproject/\n\u251c\u2500 inventory/\n\u2502  \u251c\u2500 hosts.yaml\n\u2502  \u251c\u2500 group_vars/\n\u2502  \u2502  \u2514\u2500 webservers.yml\n\u2502  \u2514\u2500 host_vars/\n\u2502     \u2514\u2500 web1.yml\n\u251c\u2500 templates/\n\u2502  \u2514\u2500 nginx.conf.j2\n\u2514\u2500 site.yml\n</code></pre></p> <p>See struktuur aitab hoida playbooki ja mallifailid korrastatuna.</p>"},{"location":"ansible/ansiblejinja2/#jinja2-suntaksi-pohitoed","title":"Jinja2 s\u00fcntaksi p\u00f5hit\u00f5ed","text":"<ul> <li>Muutuja: <code>{{ variable_name }}</code></li> <li> <p>Tingimus:</p> <p>Tingimuslause abil saab faili teatud osa lisada ainult siis, kui muutuja vastab teatud tingimusele.</p> <p>N\u00e4ide: kui <code>use_ssl</code> muutuja on <code>true</code>, kuulab server porti 443, muidu 80. Vastavalt sellele t\u00e4idetakse ka sihtfail.</p> <pre><code>{% if use_ssl %}\nlisten 443 ssl;\n{% else %}\nlisten 80;\n{% endif %}\n</code></pre> <p>Kui <code>use_ssl = true</code>, l\u00e4heb l\u00f5ppfaili:</p> <pre><code>listen 443 ssl;\n</code></pre> <p>Kui <code>use_ssl = false</code> v\u00f5i muutujat pole m\u00e4\u00e4ratud, l\u00e4heb l\u00f5ppfaili:</p> <pre><code>listen 80;\n</code></pre> </li> <li> <p>Ts\u00fckkel:</p> <p>Ts\u00fckliga saab luua korduvaid konfiguratsiooniridu, n\u00e4iteks mitu domeeninime v\u00f5i IP-d.</p> <pre><code>{% for site in sites %}\nserver_name {{ site }};\n{% endfor %}\n</code></pre> <p>Kui muutuja <code>sites</code> on m\u00e4\u00e4ratud loendina: <pre><code>sites:\n- example.com\n- test.example.com\n- demo.example.com\n</code></pre></p> <p>Siis mallist tekib j\u00e4rgmine sihtfail:</p> <pre><code>server_name example.com;\nserver_name test.example.com;\nserver_name demo.example.com;\n</code></pre> </li> <li> <p>Kommentaar failis:</p> <pre><code>{# See selgitav on kommentaar, mida l\u00f5pfaili ei lisata #}\n</code></pre> </li> </ul>"},{"location":"ansible/ansiblejinja2/#filtrite-kasutamine-jinja2-mallides","title":"Filtrite kasutamine Jinja2 mallides","text":"<p>Filtrid on v\u00e4ikesed t\u00f6\u00f6riistad, millega saab mallis olevat muutuja v\u00e4\u00e4rtust muuta v\u00f5i t\u00f6\u00f6delda enne, kui see faili kirjutatakse. Jinja2 v\u00f5imaldab kasutada erinevaid filtreid (nt | default(), | upper, | join(', ')).</p> <p>Filtrit rakendatakse p\u00fcstkriipsuga (<code>|</code>) muutuja j\u00e4rele.</p> <p>\u00dcldine kuju: <pre><code>{{ muutuja | filter_nimi }}\n</code></pre></p> <ul> <li> <p><code>default()</code> \u2013 kasutab varuv\u00e4\u00e4rtust, kui muutuja pole m\u00e4\u00e4ratud. N\u00e4ide:</p> <p><pre><code>server_name {{ server_name | default('localhost') }}\n</code></pre> Kui server_name on m\u00e4\u00e4ratud, kasutatakse selle v\u00e4\u00e4rtust. Kui muutuja puudub, pannakse localhost.</p> </li> <li> <p><code>upper</code> \u2013 muudab teksti suurt\u00e4htedeks. N\u00e4ide:</p> <pre><code>WELCOME_MESSAGE=\"{{ welcome_text | upper }}\"\n</code></pre> <p>Kui welcome_text on tere tulemast, l\u00e4heb faili TERE TULEMAST.</p> </li> <li> <p><code>join()</code> \u2013 liidab loendi elemendid \u00fcheks stringiks. N\u00e4ide:</p> <pre><code>allowed_hosts = {{ hosts | join(', ') }}\n</code></pre> <p>Kui hosts on loend: <pre><code>hosts:\n  - host1.example.com\n  - host2.example.com\n</code></pre></p> <p>Siis tulemus on: <pre><code>allowed_hosts = host1.example.com, host2.example.com\n</code></pre></p> </li> </ul>"},{"location":"ansible/ansiblejinja2/#mallide-testimine","title":"Mallide testimine","text":"<p>Testi malli <code>--check</code> ja <code>--diff</code> lipuga enne production keskkonnas kasutamist.</p> <pre><code>ansible-playbook site.yml --check --diff\n</code></pre> <p><code>--check</code> n\u00e4itab, mida playbook muudaks, ilma et muudatusi tegelikult teeks.   <code>--diff</code> n\u00e4itab failide erinevusi enne ja p\u00e4rast mallist genereerimist.</p>"},{"location":"ansible/ansiblejinja2/#head-tavad-mallide-kasutamisel","title":"Head tavad mallide kasutamisel","text":"<ul> <li>Hoia mallifailid eraldi <code>templates/</code> kataloogis.</li> <li>Testi mallid <code>--check</code> ja <code>--diff</code> abil enne tootmiskeskkonnas k\u00e4ivitamist.</li> <li>Kasuta mallides idempotentsust \u2013 v\u00e4ldi juhuslikke v\u00e4\u00e4rtusi (nt ajatemplid), mis p\u00f5hjustavad, et fail muutub igal k\u00e4ivitamisel.</li> <li>V\u00e4ldi mallides liigset loogikat \u2013 keerulisemad tingimused ja arvutused on parem teha Ansible\u2019i poolel (nt set_fact v\u00f5i vars).</li> </ul>"},{"location":"ansible/ansiblejinja2/#rohkem-infot","title":"Rohkem infot","text":"<ul> <li>Ansible Template Module </li> <li>Jinja2 Documentation </li> </ul>"},{"location":"ansible/ansibleloops/","title":"Ts\u00fcklid","text":""},{"location":"ansible/ansibleloops/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Kuidas kasutada <code>loop:</code>-i korduvate tegevuste jaoks</li> <li>Kuidas korrata tegevusi loendite, s\u00f5nastike ja failide elementide puhul</li> <li>Kuidas lahendada keerukamaid juhtumeid (nt mitme kasutaja v\u00f5i faili massiline loomine)</li> <li>Kuidas kasutada ts\u00fckleid koos mallidega (Jinja2, <code>{{ item }}</code>)</li> </ul>"},{"location":"ansible/ansibleloops/#mis-on-tsuklid","title":"Mis on ts\u00fcklid?","text":"<p>Ts\u00fcklid v\u00f5imaldavad sul sama tegevust korrata erinevate v\u00e4\u00e4rtustega \u2013 n\u00e4iteks paigaldada mitu paketti, luua mitu kataloogi, tekitada mitu kasutajat v\u00f5i kirjutada mitu konfiguratsioonifaili.</p>"},{"location":"ansible/ansibleloops/#kaasaegne-viis-korduva-tegevuse-sooritamiseks-loop","title":"Kaasaegne viis korduva tegevuse sooritamiseks (<code>loop:</code>)","text":"<p><code>loop:</code> on eelistatud ja \u00fchtne viis ts\u00fcklite kirjutamiseks k\u00f5igi moodulite juures. Ansible soovitab t\u00e4nap\u00e4eval teostada k\u00f5iki korduvaid tegevusi just <code>loop</code> abil.</p> <p>Lihtne n\u00e4ide \u2013 mitme paketi paigaldus:</p> <pre><code>---\n- name: Paigalda mitu paketti\n  hosts: webservers\n  become: yes\n  tasks:\n    - name: Paigalda paketid\n      apt:\n        name: \"{{ item }}\"\n        state: present\n      loop:\n        - curl\n        - htop\n        - git\n      when: ansible_facts['os_family'] == \"Debian\"\n</code></pre> <ul> <li><code>{{ item }}</code> sisaldab hetkel t\u00f6\u00f6deldava elemendi v\u00e4\u00e4rtust.</li> </ul>"},{"location":"ansible/ansibleloops/#vanem-viis-tsuklite-kasutamiseks-with_","title":"Vanem viis ts\u00fcklite kasutamiseks (<code>with_*:</code>)","text":"<p>Varem kasutati eri mustrite jaoks <code>with_*</code> s\u00fcntaksit: <code>with_items</code>, <code>with_dict</code>, <code>with_fileglob</code> jne. T\u00e4nap\u00e4eval soovitab Ansible kasutada <code>loop:</code>-i, sest:</p> <ul> <li>s\u00fcntaks on \u00fchtne (\u00fcks viis k\u00f5igi juhtumite jaoks);</li> <li>koos filtritega (<code>dict2items</code>, <code>subelements</code>, <code>flatten</code>, <code>unique</code> jne) saab lahendada k\u00f5ik endised <code>with_*</code> juhtumid;</li> <li>kergem lugeda ja hooldada.</li> </ul> <p>Info</p> <p><code>with_items:</code> pole k\u00fcll ametlikult eemaldatud, kuid Ansible dokumentatsioonis soovitatakse kasutada <code>loop:</code>-i. M\u00f5nedes vanemates n\u00e4idetes v\u00f5ib siiani kohata <code>with_items</code> v\u00f5i m\u00f5nda muud <code>with_*</code> ts\u00fcklit, seega on hea v\u00e4hemalt sellest v\u00f5imaluses teada, et n\u00e4idetest aru saada.</p> <p>Vana s\u00fcntaksi n\u00e4ide:</p> <pre><code>---\n- name: Paigalda mitu paketti (vana s\u00fcntaks)\n  hosts: webservers\n  become: yes\n  tasks:\n    - name: Paigalda paketid\n      apt:\n        name: \"{{ item }}\"\n        state: present\n      with_items:\n        - curl\n        - git\n        - htop\n</code></pre>"},{"location":"ansible/ansibleloops/#tsuklite-kasutamise-erinevad-viisid","title":"Ts\u00fcklite kasutamise erinevad viisid","text":""},{"location":"ansible/ansibleloops/#tsuklite-kasutamine-loendite-puhul","title":"Ts\u00fcklite kasutamine loendite puhul","text":"<p>Ts\u00fcklite abil saab sama tegevust korrata iga loendi elemendi jaoks \u2014 n\u00e4iteks paigaldada mitu paketti, luua mitu kasutajat v\u00f5i tekitada mitu kataloogi \u00fche playbooki sees.</p> <p>Mitme kasutaja loomine:</p> <pre><code>- name: Loo kasutajad  \n  user:                      # Kasutajate haldamiseks m\u00f5eldud Ansible moodul\n    name: \"{{ item.name }}\"  # M\u00e4\u00e4rab kasutaja nime vastavalt loendis olevale v\u00e4\u00e4rtusele\n    state: present           # Loob kasutaja, kui teda pole (v\u00f5i j\u00e4tab alles, kui juba olemas)\n    groups: \"{{ item.groups | default(omit) }}\"  \n      # Lisab kasutaja gruppi, kui 'groups' on m\u00e4\u00e4ratud\n      # Kui 'groups' pole m\u00e4\u00e4ratud (nt teisel kasutajal), siis 'omit' j\u00e4tab selle v\u00e4lja\n  loop:                      # Kordab seda task\u2019i iga elemendi puhul allolevas loendis\n    - { name: \"alice\", groups: \"sudo\" }  # Esimene kasutaja, lisatakse gruppi sudo\n    - { name: \"bob\" }                    # Teine kasutaja, ilma grupita\n</code></pre> <p>Mitme kataloogi loomine:</p> <pre><code>- name: Loo kataloogid  \n  file:                 # Kasutatakse Ansible 'file' moodulit failis\u00fcsteemi haldamiseks\n    path: \"{{ item }}\"  # Kataloogi tee, mille v\u00e4\u00e4rtus tuleb ts\u00fcklis loendist\n    state: directory    # M\u00e4\u00e4rab, et objekt peab olema kataloog (loob selle, kui puudub)\n    mode: \"0755\"        # Seab \u00f5igused: omaniku kirjutus/lugemis\u00f5igus, teistele lugemis\u00f5igus\n  loop:                 # K\u00e4ivitab task\u2019i iga alloleva loendi elemendi jaoks kordam\u00f6\u00f6da\n    - /opt/app/logs     # Esimene kataloog, mis luuakse\n    - /opt/app/data     # Teine kataloog, mis luuakse\n</code></pre> <p>Muutuja kasutamine ts\u00fcklina</p> <pre><code>---\n- name: Paigalda mitmeid pakette \n  hosts: webservers    \n  become: yes                       \n\n  vars:                             \n    packages:                       # Muutujana loend paketitest, mida soovime paigaldada\n      - nginx\n      - curl\n      - vim\n\n  tasks:                            \n    - name: Paigalda vajalikud paketid       \n      apt:                                   # Kasutame 'apt' moodulit (Debiani/Ubuntu s\u00fcsteemides)\n        name: \"{{ item }}\"                   # Paigaldatav paketi nimi tuleb ts\u00fckli elemendist\n        state: present                       # Tagab, et pakett on olemas (paigaldatud)\n      loop: \"{{ packages }}\"                 # Ts\u00fckkel \u2013 kordab \u00fclesannet iga loendis oleva paketi jaoks\n</code></pre>"},{"location":"ansible/ansibleloops/#tsuklite-kasutamine-sonastike-dict-puhul","title":"Ts\u00fcklite kasutamine s\u00f5nastike (dict) puhul","text":"<p>Ts\u00fcklite abil saab t\u00f6\u00f6delda ka s\u00f5nastikke, kus iga element koosneb v\u00f5tme\u2013v\u00e4\u00e4rtuse paarist \u2014 n\u00e4iteks seadistused, kasutajanimed koos gruppidega v\u00f5i paketid koos versioonidega. S\u00f5nastikke on mugav ts\u00fckliks vormida Jinja2 filtriga <code>dict2items</code> (teeb <code>{key:\u2026, value:\u2026}</code> loendi).</p> <pre><code>- name: Paigalda paketid koos target-versioonidega   \n  apt:                                               # Kasutatakse 'apt' moodulit \n    name: \"{{ item.key }}={{ item.value }}\"          # Iga ts\u00fckli k\u00e4igus \u00fchendatakse paketi nimi (key) ja versioon (value)\n    state: present                                   # Tagab, et m\u00e4\u00e4ratud versioon on paigaldatud\n  loop: \"{{ packages | dict2items }}\"                # Teisendab s\u00f5nastiku loendiks (dict \u2192 [{key:\u2026, value:\u2026}, \u2026])\n  vars:                                              \n    packages:                                        # S\u00f5nastik, kus iga kirje koosneb paketi nimest (v\u00f5ti) ja versioonist (v\u00e4\u00e4rtus)\n      nginx: 1.24.0-1                                # Paigaldatakse konkreetne nginx versioon\n      git: 1:2.43.0-1                                # Paigaldatakse konkreetne git versioon\n</code></pre> <p>Lihtsam \u201ev\u00f5ti-v\u00e4\u00e4rtus\u201d kasutajate halduse n\u00e4itel:</p> <pre><code>- name: Loo kasutajad (dict)\n  user:                                   # Kasutajate haldamise moodul\n    name: \"{{ item.key }}\"                # Kasutajanimi tuleb s\u00f5nastiku v\u00f5tme (key) v\u00e4\u00e4rtusest\n    state: present                        # Tagab, et kasutaja eksisteerib (luuakse, kui teda pole)\n    groups: \"{{ item.value.groups | default(omit) }}\"  \n      # Kui s\u00f5nastiku v\u00e4\u00e4rtuses on m\u00e4\u00e4ratud grupp (groups), lisatakse kasutaja sellesse gruppi\n      # Kui gruppi pole m\u00e4\u00e4ratud, j\u00e4tab 'omit' selle v\u00e4lja, et v\u00e4ltida t\u00fchja v\u00e4\u00e4rtuse viga\n  loop: \"{{ users | dict2items }}\"        # Teisendab 'users' s\u00f5nastiku loendiks [{key:\u2026, value:\u2026}, \u2026]\n  vars:\n    users:                                # S\u00f5nastik kasutajatest ja nende omadustest\n      alice: { groups: \"sudo\" }           # Kasutaja 'alice' lisatakse gruppi 'sudo'\n      bob: {}                             # Kasutaja 'bob' luuakse ilma grupita\n</code></pre>"},{"location":"ansible/ansibleloops/#tsuklite-kasutamine-failide-puhul","title":"Ts\u00fcklite kasutamine failide puhul","text":"<p>Sageli on vaja teha sama tegevust mitme faili jaoks \u2014 n\u00e4iteks kopeerida konfiguratsioonifaile v\u00f5i luua linke. Ts\u00fcklite abil saab selliseid korduvaid failitoiminguid automatiseerida, kasutades kas failide loendit v\u00f5i <code>fileglob</code> p\u00e4ringut, mis leiab k\u00f5ik sobivad failid kataloogist.</p> <p>Failiglob koos <code>loop:</code>-iga:</p> <pre><code>- name: Kopeeri k\u00f5ik .conf failid kataloogist files/app/\n  copy:                                                    # Kasutatakse 'copy' moodulit failide kopeerimiseks\n    src: \"{{ item }}\"                                      # Allikas \u2013 iga ts\u00fckli k\u00e4igus \u00fcks fail, mille tee tuleb loendist\n    dest: \"/etc/myapp/{{ item | basename }}\"               # Sihtkoht \u2013 fail kopeeritakse /etc/myapp/ kataloogi\n                                                           # 'basename' filter eemaldab failiteest kataloogiosa, j\u00e4ttes alles ainult failinime\n    mode: \"0644\"                                           # Seab failidele \u00f5igused (omanik kirjutab, teised loevad)\n  loop: \"{{ lookup('fileglob', 'files/app/*.conf', wantlist=True) }}\"  \n    # lookup('fileglob', 'muster', wantlist=True) leiab k\u00f5ik failid, mis vastavad mustrile files/app/*.conf\n    # tulemuseks on loend failide t\u00e4ielikest radadest, mida ts\u00fcklis \u00fckshaaval t\u00f6\u00f6deldakse\n</code></pre> <ul> <li><code>lookup('fileglob', pattern, wantlist=True)</code> leiab k\u00f5ik mustriga sobivad failid ja annab need loendina <code>loop:</code>-ile t\u00f6\u00f6tlemiseks.</li> </ul>"},{"location":"ansible/ansibleloops/#tsuklite-tulemused-ja-register","title":"Ts\u00fcklite tulemused ja <code>register</code>","text":"<p>Kui salvestad ts\u00fckliga \u00fclesande tulemuse muutujasse register, siis Ansible ei salvesta ainult \u00fchte v\u00e4\u00e4rtust, vaid loob loendi k\u00f5igi ts\u00fckli k\u00e4ikude tulemustest. See t\u00e4hendab, et iga kord, kui ts\u00fckkel t\u00e4idab \u00fche elemendi, lisatakse selle tulemus eraldi kirjena \u00fcldisesse tulemuste loendisse.</p> <pre><code>- name: Kontrolli portide staatust\n  shell: \"ss -lnt | grep -q ':{{ item }} '\"   # Kontrollib, kas vastav port on kuulamisel\n  register: port_checks                       # Salvestab k\u00f5ik tulemused muutujasse 'port_checks'\n  ignore_errors: yes                          # J\u00e4tkab ka siis, kui m\u00f5ni kontroll eba\u00f5nnestub\n  loop:                                       # Kontrollib kahte porti\n    - 80\n    - 443\n\n- name: N\u00e4ita tulemused\n  debug:\n    var: port_checks.results                  # Kuvab kogu ts\u00fckli tulemuste loendi\n</code></pre> <p>Igal <code>results</code> elemendil on n\u00e4iteks <code>item</code>, <code>rc</code>, <code>stdout</code>, <code>stderr</code> jne. <code>rc</code> \u2013 return code ehk k\u00e4su l\u00f5petamise kood (0 = \u00f5nnestus, muu = viga).</p> <p>Kui soovid kuvada ainult eba\u00f5nnestunud tulemused, saad kasutada filtrit:</p> <p><pre><code>- name: N\u00e4ita ainult eba\u00f5nnestunud tulemused\n  debug:\n    msg: \"Port {{ item.item }} ei ole avatud\"\n  loop: \"{{ port_checks.results }}\"\n  when: item.rc != 0\n</code></pre> See k\u00e4ib l\u00e4bi tulemuste loendi ja n\u00e4itab ainult neid, kus rc ei ole 0 \u2014 ehk k\u00e4su t\u00e4itmine eba\u00f5nnestus.</p>"},{"location":"ansible/ansibleloops/#keerukamate-tsuklite-naited","title":"Keerukamate ts\u00fcklite n\u00e4ited","text":""},{"location":"ansible/ansibleloops/#alamstruktuurid-subelements","title":"Alamstruktuurid (<code>subelements</code>)","text":"<p>Kui on loend objekte, millest igal on alamloend, kasuta filtrit <code>subelements</code>:</p> <pre><code>- name: Loo kasutajatele SSH v\u00f5tmed\n  copy:                                         # Kasutatakse 'copy' moodulit failide kirjutamiseks\n    dest: \"/home/{{ item.0.name }}/.ssh/authorized_keys\"  \n      # Sihtfail, kuhu v\u00f5tmed kirjutatakse\n      # 'item.0' on kasutajaobjekt (p\u00f5hielement ts\u00fcklis)\n    content: \"{{ item.1 }}\"                     # Faili sisu \u2013 \u00fcksiku v\u00f5tme v\u00e4\u00e4rtus alamloendist\n    owner: \"{{ item.0.name }}\"                  # Faili omanik \u2013 vastav kasutaja\n    group: \"{{ item.0.name }}\"                  # Faili grupp \u2013 sama, mis kasutaja nimi\n    mode: \"0600\"                                # Faili \u00f5igused \u2013 ainult omanik v\u00f5ib lugeda/kirjutada\n  loop: \"{{ users | subelements('authorized_keys') }}\"  \n    # subelements('authorized_keys') tekitab alamts\u00fckli:\n    # iga kasutaja (item.0) kombineeritakse tema iga v\u00f5tmega (item.1)\n  vars:\n    users:                                      # Loend kasutajatest ja nende SSH v\u00f5tmetest\n      - name: \"alice\"                           # Esimene kasutaja\n        authorized_keys:                        # Loend v\u00f5tmetest, mis lisatakse Alicele\n          - \"ssh-ed25519 AAAAC... alice@laptop\"\n          - \"ssh-ed25519 AAAAC... alice@work\"\n      - name: \"bob\"                             # Teine kasutaja\n        authorized_keys:\n          - \"ssh-ed25519 AAAAC... bob@home\"\n</code></pre> <ul> <li><code>item.0</code> viitab p\u00f5hielemendile (kasutajale) ja <code>item.1</code> on selle elemendi alamloendis olev v\u00e4\u00e4rtus (\u00fcks SSH v\u00f5ti).</li> </ul>"},{"location":"ansible/ansibleloops/#mitme-mootmega-tsukkel-tootekombinatsioonid","title":"Mitme m\u00f5\u00f5tmega ts\u00fckkel (tootekombinatsioonid)","text":"<pre><code>- name: Loo kaustad keskkondade ja teenuste kombinatsioonidele   \n  file:                                                          # 'file' moodul loob v\u00f5i haldab faile ja katalooge\n    path: \"/srv/{{ item.env }}/{{ item.svc }}\"                   # Kausta tee \u2013 kombineerib keskkonna ja teenuse nime\n    state: directory                                             # Tagab, et see tee on kataloog (loob, kui puudub)\n  loop: \"{{ query('cartesian', envs, services) | map('combine') | list }}\"  \n    # 'query('cartesian', ...)' loob k\u00f5ik v\u00f5imalikud kombinatsioonid kahest loendist (envs ja services)\n    # N\u00e4iteks: dev+api, dev+worker, prod+api, prod+worker\n    # 'map('combine')' liidab kahe loendi objektid \u00fcheks s\u00f5nastikuks\n    # 'list' muudab tulemuse l\u00f5plikuks loendiks, mida saab ts\u00fcklis l\u00e4bi k\u00e4ia\n  vars:                                                          \n    envs:                                                        # Loend keskkondadest\n      - { env: \"dev\" }                                           # Arenduskeskkond\n      - { env: \"prod\" }                                          # Tootmiskeskkond\n    services:                                                    # Loend teenustest\n      - { svc: \"api\" }                                           # API teenus\n      - { svc: \"worker\" }                                        # Taustateenus (worker)\n</code></pre>"},{"location":"ansible/ansibleloops/#iteratsiooni-indeks-ja-silt","title":"Iteratsiooni indeks ja silt","text":"<p><code>loop_control</code> annab ligip\u00e4\u00e4su indeksile ja inimloetavale m\u00e4rgisele:</p> <pre><code>- name: Loo kaustad koos indeksiga           \n  file:                                      # 'file' moodul \u2013 loob v\u00f5i haldab faile ja katalooge\n    path: \"/data/{{ index }}-{{ item }}\"     # Kataloogi tee: koosneb indeksist ja elemendi v\u00e4\u00e4rtusest (nt /data/0-a)\n    state: directory                         # Tagab, et tee on kataloog (loob selle, kui puudub)\n  loop: [\"a\", \"b\", \"c\"]                      # Lihtne loend, mille elemente t\u00f6\u00f6deldakse ts\u00fcklis j\u00e4rjest\n  loop_control:                              # T\u00e4iendav ts\u00fcklite juhtimine\n    index_var: index                         # Loob eraldi muutuja 'index', mis sisaldab ts\u00fckli j\u00e4rjekorranumbrit (alates 0)\n    label: \"{{ index }} -&gt; {{ item }}\"       # M\u00e4\u00e4rab, kuidas ts\u00fckli element kuvatakse v\u00e4ljundis (nt 0 -&gt; a)\n</code></pre> <ul> <li>on kasulik n\u00e4iteks j\u00e4rjestatud objektide loomisel v\u00f5i silumiseks, kui soovid teada, mitmendal sammul ts\u00fckkel parasjagu on.</li> </ul>"},{"location":"ansible/ansibleloops/#tsuklid-ja-jinja2-mallid","title":"Ts\u00fcklid ja Jinja2 mallid","text":"<p>Ts\u00fckleid saab kombineerida mallide paigaldamisega, et luua mitu konfiguratsioonifaili erinevate v\u00e4\u00e4rtustega.</p> <p>Mallifail <code>templates/vhost.conf.j2</code>:</p> <pre><code>server {\n    listen 80;\n    server_name {{ item.server_name }};\n    root {{ item.web_root }};\n}\n</code></pre> <p>Playbooki v\u00e4ljav\u00f5te:</p> <pre><code>- name: Loo vhostid mallist\n  template:\n    src: vhost.conf.j2\n    dest: \"/etc/nginx/sites-available/{{ item.server_name }}.conf\"\n  loop:\n    - { server_name: \"example.com\", web_root: \"/var/www/example\" }\n    - { server_name: \"demo.example.com\", web_root: \"/var/www/demo\" }\n  notify: Taask\u00e4ivita nginx\n\nhandlers:\n  - name: Taask\u00e4ivita nginx\n    service:\n      name: nginx\n      state: restarted\n</code></pre> <p>Mallis saab kasutada <code>{{ item.* }}</code> v\u00e4\u00e4rtusi, mis tulevad ts\u00fckli elemendist.</p>"},{"location":"ansible/ansibleloops/#testimine-ja-veaotsing","title":"Testimine ja veaotsing","text":"<ul> <li>Kasuta <code>--check</code> ja <code>--diff</code>, et n\u00e4ha muudatusi enne rakendamist.</li> <li>Lisa <code>-v</code> / <code>-vvv</code>, et n\u00e4ha, milliseid elemente t\u00f6\u00f6deldi.</li> <li>Kui ts\u00fckkel on keerukas, on kasulik v\u00e4ljastada vahev\u00e4\u00e4rtusi <code>debug:</code> abil.</li> </ul> <pre><code>- name: Kuvan t\u00f6\u00f6tlemisel kasutatava elemendi\n  debug:\n    msg: \"T\u00f6\u00f6tlen: {{ item }}\"\n  loop: \"{{ my_list }}\"\n</code></pre>"},{"location":"ansible/ansibleloops/#head-tavad","title":"Head tavad","text":"<ul> <li>Kasuta <code>loop:</code> ja filtreid (<code>dict2items</code>, <code>subelements</code>, <code>flatten</code>) \u2013 v\u00e4ldi <code>with_*</code> s\u00fcntaksit uues koodis.</li> <li>Tee elementide struktuur selgeks (nt <code>{name:\u2026, uid:\u2026}</code>) \u2013 see teeb mallid ja taskid loetavaks.</li> <li>V\u00e4ldi shelli, kui leidub spetsiaalne moodul (idempotentsus).</li> <li>Kui ts\u00fckkel muutub keerukaks, jaga v\u00e4iksemateks taskideks v\u00f5i kasuta rolle (rollidest r\u00e4\u00e4gime hilisemas materjalis).</li> <li>Vajadusel kasuta <code>loop_control</code>-it indeksi ja sildi jaoks.</li> </ul>"},{"location":"ansible/ansibleloops/#rohkem-infot","title":"Rohkem infot","text":"<ul> <li>Ansible loops (playbook guide)</li> <li>Jinja2 filters</li> <li>Lookups: fileglob, cartesian, subelements</li> </ul>"},{"location":"ansible/ansiblemodules/","title":"Moodulid ja ad-hoc k\u00e4sud","text":""},{"location":"ansible/ansiblemodules/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Mis on Ansible moodulid ja miks neid kasutatakse  </li> <li>Kuidas k\u00e4ivitada ad-hoc k\u00e4ske Ansible abil  </li> <li>Levinumad moodulid ja nende kasutamine (Linux ja Windows)  </li> <li>Kuidas leida abi moodulite kasutamise kohta</li> </ul>"},{"location":"ansible/ansiblemodules/#mis-on-moodulid","title":"Mis on moodulid?","text":"<ul> <li>Moodul on Ansible p\u00f5hikomponent, mis t\u00e4idab konkreetset \u00fclesannet hallataval hostil.  </li> <li>Moodulid on nagu t\u00f6\u00f6riistad \u2013 igal \u00fchel on kindel funktsioon (nt failide kopeerimine, pakettide paigaldamine, kasutajate haldus).  </li> <li>Ansible ei logi lihtsalt hosti sisse ja ei k\u00e4ivita k\u00e4ske otse \u2013 ta kasutab mooduleid, mis tagavad idempotentse ja standardiseeritud tulemuse.  </li> </ul> <p>Info</p> <p>Idempotentsus t\u00e4hendab seda, et sama playbook\u2019i v\u00f5i mooduli k\u00e4ivitamine mitu korda j\u00e4rjest ei muuda s\u00fcsteemi seisundit p\u00e4rast esimest edukat k\u00e4ivitust.</p>"},{"location":"ansible/ansiblemodules/#naited-moodulitest","title":"N\u00e4ited moodulitest","text":"<ul> <li>ping \u2013 kontrollib, kas hostiga saab \u00fchenduda (Linux);  </li> <li>win_ping \u2013 kontrollib \u00fchendust Windows hostiga;  </li> <li>copy \u2013 kopeerib faile;  </li> <li>apt / yum / dnf \u2013 paigaldab v\u00f5i eemaldab tarkvara (olenevalt Linuxi distributsioonist);  </li> <li>service / systemd \u2013 k\u00e4ivitab v\u00f5i peatab teenuseid;  </li> <li>user \u2013 haldab kasutajakontosid;</li> <li>win_feature - paigaldab v\u00f5i eemaldab Windowsi Serveri rollid ja funktsioonid. </li> </ul>"},{"location":"ansible/ansiblemodules/#mooduli-nime-kasutamine-luhike-vs-taisnimi","title":"Mooduli nime kasutamine (l\u00fchike vs t\u00e4isnimi)","text":"<p>Ansible\u2019is saab mooduleid kutsuda kas l\u00fchinimega v\u00f5i t\u00e4isnimega. N\u00e4iteks:</p> <pre><code># L\u00fchinimi\nansible all -m ping\n\n# T\u00e4isnimi\nansible all -m ansible.builtin.ping\n</code></pre> <ul> <li>L\u00fchivorm (ping, copy, service) on mugavam ja t\u00f6\u00f6tab siis, kui moodul p\u00e4rineb Ansible enda sisseehitatud kogust (builtin).</li> <li>T\u00e4isvorm (n: ansible.builtin.ping) muutus oluliseks alates Ansible Collections s\u00fcsteemist (versioon 2.9+). See v\u00e4ldib segadust, kui sama nimega moodul on saadaval mitmes kogus.</li> </ul> <p>Kogu (collection) on moodulite, plugin\u2019ite ja rollide kogumik. Ansible jagas moodulid kogudesse, et neid oleks lihtsam hallata ja uuendada.</p> <p>N\u00e4iteks:</p> <ul> <li>ansible.builtin \u2013 Ansible enda sisseehitatud moodulid (nt ping, copy).</li> <li>ansible.windows \u2013 Microsoft Windowsi moodulid.</li> <li>community.general \u2013 kogukonna loodud moodulid, mida pole vaikimisi Ansible sees.</li> </ul> <p>Info</p> <p>Enamasti piisab l\u00fchinimest, aga dokumentatsioonis n\u00e4ed sageli ka t\u00e4isnimekujusid. Kui v\u00f5tad mooduli v\u00e4ljastpoolt Ansible sisseehitatud kogu, tuleb kasutada t\u00e4isnime.</p>"},{"location":"ansible/ansiblemodules/#mis-on-ad-hoc-kasud","title":"Mis on ad-hoc k\u00e4sud?","text":"<ul> <li>Ad-hoc k\u00e4sud on \u00fchekordsed Ansible k\u00e4sud, millega saab kiiresti mooduleid kasutada ilma playbooki kirjutamata.  </li> <li>Need sobivad katsetamiseks, kiireks muudatuseks v\u00f5i kontrollimiseks.  </li> <li>K\u00e4ivitatakse k\u00e4surealt <code>ansible</code> k\u00e4su abil.  </li> </ul>"},{"location":"ansible/ansiblemodules/#suntaks","title":"S\u00fcntaks","text":"<pre><code>ansible &lt;host v\u00f5i grupp&gt; -m &lt;moodul&gt; -a \"&lt;argumendid&gt;\" -i &lt;inventory&gt;\n</code></pre> <ul> <li><code>&lt;host v\u00f5i grupp&gt;</code> \u2013 hosti alias v\u00f5i grupi nimi inventory failist;  </li> <li><code>-m</code> \u2013 m\u00e4\u00e4rab mooduli;  </li> <li><code>-a</code> \u2013 annab moodulile argumendid;  </li> <li><code>-i</code> \u2013 m\u00e4\u00e4rab inventory faili (ilma selleta kasutatakse vaikimisi faili).  </li> </ul>"},{"location":"ansible/ansiblemodules/#ad-hoc-kasu-naited","title":"Ad-hoc k\u00e4su n\u00e4ited","text":""},{"location":"ansible/ansiblemodules/#linux-hostidel","title":"Linux hostidel","text":"<p>Kontrolli \u00fchendust (ping moodul): <pre><code>ansible linux -m ping -i hosts.ini\n</code></pre></p> <p>Paigalda Apache (kasutades apt moodulit): <pre><code>ansible webservers -m apt -a \"name=apache2 state=present update_cache=yes\" -b -i hosts.ini\n</code></pre></p> <p>Kopeeri fail kohalikust masinast hostile: <pre><code>ansible linux -m copy -a \"src=./test.txt dest=/tmp/test.txt\" -i hosts.ini\n</code></pre></p> <p>K\u00e4ivita teenus: <pre><code>ansible webservers -m service -a \"name=apache2 state=started enabled=yes\" -b -i hosts.ini\n</code></pre></p>"},{"location":"ansible/ansiblemodules/#windows-hostidel","title":"Windows hostidel","text":"<p>Kontrolli \u00fchendust (win_ping): <pre><code>ansible windows -m win_ping -i hosts.ini\n</code></pre></p> <p>Paigalda Windowsi funktsioon (nt IIS): <pre><code>ansible winservers -m win_feature -a \"name=Web-Server state=present\" -i hosts.ini\n</code></pre></p> <p>Kopeeri fail Windowsi hostile: <pre><code>ansible winservers -m win_copy -a \"src=./test.txt dest=C:\\\\Temp\\\\test.txt\" -i hosts.ini\n</code></pre></p> <p>K\u00e4ivita teenus Windowsis: <pre><code>ansible winservers -m win_service -a \"name=Spooler state=restarted\" -i hosts.ini\n</code></pre></p>"},{"location":"ansible/ansiblemodules/#levinumad-moodulid","title":"Levinumad moodulid","text":""},{"location":"ansible/ansiblemodules/#linux","title":"Linux","text":"<ul> <li><code>ping</code> \u2013 \u00fchenduse kontroll.  </li> <li><code>command</code> / <code>shell</code> \u2013 k\u00e4skude k\u00e4ivitamine (ettevaatusega!).  </li> <li><code>copy</code> \u2013 failide kopeerimine.  </li> <li><code>file</code> \u2013 failide/kaustade \u00f5iguste ja oleku haldamine.  </li> <li><code>package</code> \u2013 universaalne pakettide paigaldamise moodul.  </li> <li><code>service</code> \u2013 teenuste haldamine.  </li> <li><code>user</code> \u2013 kasutajate loomine ja haldamine.  </li> </ul>"},{"location":"ansible/ansiblemodules/#windows","title":"Windows","text":"<ul> <li><code>win_ping</code> \u2013 \u00fchenduse kontroll.  </li> <li><code>win_command</code> / <code>win_shell</code> \u2013 k\u00e4skude k\u00e4ivitamine.  </li> <li><code>win_copy</code> \u2013 failide kopeerimine.  </li> <li><code>win_file</code> \u2013 failide/kaustade haldamine.  </li> <li><code>win_package</code> \u2013 tarkvara paigaldamine MSI/exe abil.  </li> <li><code>win_service</code> \u2013 teenuste haldamine.  </li> <li><code>win_user</code> \u2013 kasutajate haldamine.  </li> </ul>"},{"location":"ansible/ansiblemodules/#kust-leida-abi-moodulite-kasutamisel","title":"Kust leida abi moodulite kasutamisel?","text":"<p>Kui sa ei tea, kuidas m\u00f5ni moodul t\u00f6\u00f6tab v\u00f5i milliseid argumente ta toetab, on mitu v\u00f5imalust abi saamiseks:</p> <ul> <li> <p>Ansible dokumentatsioon \u2013 iga mooduli kohta on olemas detailne juhend ja n\u00e4ited: https://docs.ansible.com/ansible/latest/collections/index_module.html </p> </li> <li> <p>K\u00e4surea abi \u2013 saad otse terminalis mooduli kohta infot, n\u00e4iteks:    <pre><code>ansible-doc ping\nansible-doc copy\nansible-doc -l # n\u00e4itab k\u00f5iki saadaval mooduleid\n</code></pre></p> </li> </ul>"},{"location":"ansible/ansiblemodules/#head-tavad","title":"Head tavad","text":"<ul> <li>Kasuta ad-hoc k\u00e4ske ainult kiireks testimiseks \u2013 p\u00e4ris konfiguratsiooni jaoks kirjuta playbookid.  </li> <li>Kasuta v\u00f5imalusel mooduleid, mitte k\u00e4ske <code>command</code> v\u00f5i <code>shell</code>, sest moodulid on idempotentsed.  </li> <li>Alusta alati \u00fchenduse testimisest moodulitega <code>ping</code> v\u00f5i <code>win_ping</code>.  </li> <li>Kasuta <code>-b</code> (become), kui vajad root \u00f5igusi Linuxi hostides.  </li> </ul>"},{"location":"ansible/ansiblemodules/#rohkem-infot","title":"Rohkem infot","text":"<ul> <li>Ansible modules </li> <li>Intro to ad-hoc commands </li> </ul>"},{"location":"ansible/ansiblenodes/","title":"Hallatavate hostide \u00fchendamine","text":""},{"location":"ansible/ansiblenodes/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Kuidas Ansible control node \u00fchendub hallatavate masinatega (Linux ja Windows)  </li> <li>Millised eeldused peavad olema t\u00e4idetud  </li> <li>Kuidas seadistada SSH \u00fchendus Linux hostidega  </li> <li>Kuidas seadistada SSH ja WinRM \u00fchendus Windows hostidega  </li> <li>Kuidas kontrollida, et \u00fchendus toimib  </li> </ul>"},{"location":"ansible/ansiblenodes/#kuidas-ansible-uhendub-hostidega","title":"Kuidas Ansible \u00fchendub hostidega?","text":"<ul> <li>Linux hostid \u2013 Ansible kasutab SSH-\u00fchendust, mis p\u00f5hineb tavaliselt OpenSSH-l.  </li> <li>Windows hostid \u2013 Ansible kasutab SSH (OpenSSH) v\u00f5i WinRM-\u00fchendust (Windows Remote Management).  </li> </ul> <p>Control node ei vaja agenttarkvara. Piisab, kui hallatavatel masinatel on avatud ja \u00f5igesti seadistatud SSH v\u00f5i WinRM teenus.  </p>"},{"location":"ansible/ansiblenodes/#eeldused","title":"Eeldused","text":""},{"location":"ansible/ansiblenodes/#linuxi-host","title":"Linuxi host","text":"<ul> <li>SSH server peab olema paigaldatud ja t\u00f6\u00f6tama.  </li> <li>Ansible control node peab omama ligip\u00e4\u00e4su kas parooliga v\u00f5i SSH v\u00f5tmega.  </li> <li>Lisaks peab Linuxi masinas olema Python (vaikimisi olemas enamikes distributsioonides)</li> </ul>"},{"location":"ansible/ansiblenodes/#windowsi-host","title":"Windowsi host","text":"<ul> <li>Windowsi masin peab olema seadistatud kasutama OpenSSH-serverit v\u00f5i lubama WinRM-i.</li> <li>Kui kasutatakse OpenSSH-d:<ul> <li>OpenSSH-server peab olema paigaldatud ja t\u00f6\u00f6tav.</li> <li>Tulem\u00fc\u00fcr peab lubama SSH liikluse (port 22).</li> </ul> </li> <li>Kui kasutatakse WinRM-i:<ul> <li>WinRM peab olema lubatud ja konfigureeritud (pole vaikimisi sees).</li> <li>Windowsi tulem\u00fc\u00fcr peab lubama vajalikud pordid (vaikimisi 5985 HTTP, 5986 HTTPS).</li> </ul> </li> <li>Ansible peab teadma, et tegemist on Windows hostiga - vajalikud inventory muutujad (nt ansible_connection, ansible_winrm_transport, ansible_shell_type jne).  </li> </ul>"},{"location":"ansible/ansiblenodes/#linux-hosti-uhendamine-ansibleiga","title":"Linux hosti \u00fchendamine Ansible'iga","text":"<ol> <li> <p>Loo SSH v\u00f5ti (kui seda veel pole loodud)     <pre><code>ssh-keygen -t ed25519\n</code></pre>     Kui j\u00e4tkad lihtsalt Enteriga, siis vaikimisi salvestatakse privaatv\u00f5ti <code>~/.ssh/id_ed25519</code> ja avalik v\u00f5ti <code>~/.ssh/id_ed25519.pub</code>.</p> </li> <li> <p>Kopeeri v\u00f5ti hallatavasse masinasse     <pre><code>ssh-copy-id kasutaja@host\n</code></pre>     N\u00e4iteks:     <pre><code>ssh-copy-id student@192.168.1.50\n</code></pre></p> </li> <li> <p>Testi SSH \u00fchendust     <pre><code>ssh student@192.168.1.50\n</code></pre>     Kui saad ilma parooli k\u00fcsimata sisse, on k\u00f5ik korras.</p> </li> <li> <p>Lisa host inventory faili</p> <p>N\u00e4ited:</p> <p><code>ini</code>: <pre><code>[webservers]\nweb1 ansible_host=192.168.1.10 ansible_user=student\n</code></pre></p> <p><code>yaml</code>:   <pre><code>all:\n  children:\n    webservers:\n      hosts:\n        web1:\n          ansible_host: 192.168.1.10\n          ansible_user: student\n</code></pre></p> <p>Info</p> <p>Kasutajanime peab m\u00e4\u00e4rama ainult siis kui see erineb control node\u2019i kasutajanimest.</p> </li> <li> <p>Kontrolli \u00fchendust Ansible\u2019iga</p> <p>Proovime kontrolliks Ansible abil k\u00e4ivitada ping moodulit:</p> <p>N\u00e4ide:  <pre><code>ansible -i inventory/hosts.yml web1 -m ping\n</code></pre> v\u00f5i (kui inventory failile pole eraldi vaja viidata) <pre><code>ansible -i web1 -m ping\n</code></pre></p> <p>Kui k\u00f5ik t\u00f6\u00f6tab, saad tulemuseks midagi sellist ehk \"ping\"-ile tuleb vastuseks \"pong\": <pre><code>web1 | SUCCESS =&gt; {\n  \"changed\": false,\n  \"ping\": \"pong\"\n}\n</code></pre></p> <p>Info</p> <p>Ansible ping moodul ei tee ICMP ping\u2019i, vaid testib reaalselt mooduli t\u00e4itmist Pythoniga.</p> </li> </ol>"},{"location":"ansible/ansiblenodes/#windows-hosti-uhendamine-ansibleiga","title":"Windows hosti \u00fchendamine Ansible'iga","text":"<p>Nagu eelnevalt mainitud, on Windowsi hosti v\u00f5imalik t\u00e4nap\u00e4eval \u00fchendada Ansible'iga kas OpenSSH v\u00f5i WinRM kaudu. Viimastel aastatel on selgelt n\u00e4ha trendi, kus SSH muutub \u00fcha populaarsemaks alternatiiviks WinRM-ile.</p>"},{"location":"ansible/ansiblenodes/#windowsi-uhendusmeetodite-vordlus","title":"Windowsi \u00fchendusmeetodite v\u00f5rdlus","text":"Omadus / Protokoll WinRM OpenSSH Toetus Windowsi ametlik vaikimisi haldusprotokoll Alates Windows 10 / Server 2019 ametlikult toetatud \u00dchendusviis HTTP(S) portidel 5985 / 5986 SSH (tavaliselt port 22) Turvalisus Vajab t\u00e4iendavat seadistust kr\u00fcpteeritud \u00fchenduse jaoks Kasutab kohe turvalist SSH protokolli Kasutus Ansible'is <code>ansible_connection=winrm</code> <code>ansible_connection=ssh</code> Shell PowerShell CMD v\u00f5i PowerShell (m\u00e4\u00e4ratav <code>ansible_shell_type</code>) Plussid S\u00fcgav Windowsi integratsioon, lai haldusv\u00f5imekus Lihtne, Linuxiga \u00fchtne t\u00f6\u00f6voog, v\u00e4hem seadistust Miinused V\u00f5ib olla keeruline seadistada (eriti kr\u00fcpteering ja tulem\u00fc\u00fcrid) K\u00f5ik Windowsi k\u00e4sud ei t\u00f6\u00f6ta OpenSSH shellis samamoodi kui PowerShellis"},{"location":"ansible/ansiblenodes/#windows-hosti-uhendamine-ansibleiga-openssh-abil","title":"Windows hosti \u00fchendamine Ansible'iga OpenSSH abil","text":"<p>Windowsi masinatele saab Ansible'iga ligi ka OpenSSH-serveri kaudu, mis on t\u00e4nap\u00e4eval paljudes Windowsi versioonides (nt Windows 10, 11 ja Server 2019+) juba sisseehitatud v\u00f5i h\u00f5lpsasti paigaldatav. J\u00e4rgnevalt vaatame samm-sammult selle seadistamist.</p> <ol> <li>Ava Windowsi hostis PowerShell/Terminal administraatorina.</li> <li>Kontrolli, kas OpenSSH Server on juba paigaldatud:     <pre><code>Get-WindowsCapability -Online | Where-Object Name -like 'OpenSSH.Server*'\n</code></pre></li> <li>Kui ei ole paigaldatud, paigalda:     <pre><code>Add-WindowsCapability -Online -Name OpenSSH.Server\n</code></pre></li> <li>K\u00e4ivita ja luba teenus automaatselt:     <pre><code>Set-Service -Name sshd -StartupType 'Automatic'\nStart-Service sshd\n</code></pre></li> <li>Ava port 22 (SSH) Windowsi tulem\u00fc\u00fcris:     <pre><code>New-NetFirewallRule -Name sshd -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22\n</code></pre></li> <li>V\u00f5tmetega autenimise jaoks luba ja k\u00e4ivita <code>ssh-agent</code> teenus:     <pre><code>Set-Service -Name ssh-agent -StartupType 'Automatic'\nStart-Service ssh-agent\n</code></pre></li> <li> <p>Windowsis on v\u00f5tmega autentimine natuke teistsugune kui Linuxis. Administrator konto puhul soovitab Microsoft kasutada <code>authorized_keys</code> jaoks spetsiaalset faili: <code>C:\\ProgramData\\ssh\\administrators_authorized_keys</code>, mille sisse tuleb lisada Ansible CN masina avalik v\u00f5ti.      Selleks leia Ansible CN masinast \u00fcles eelnevalt avalik v\u00f5ti, mida soovid kasutada.</p> <p>N\u00e4iteks: <pre><code>cat ~/.ssh/id_ed25519.pub\n</code></pre> Kopeeri v\u00f5ti t\u00e4ielikult, et saaksid seda kasutada.</p> <p>Info</p> <p>Tavakasutaja jaoks on ka v\u00f5tmeid v\u00f5imalik luua kui selleks on vajadust. Siis on Windowsil kasutusel teekond <code>C:\\Users\\kasutaja\\.ssh\\authorized_keys</code>.</p> </li> <li> <p>Loo parooliga \u00fchendus Ansible CN masinast Windows Serverisse (eeldame, et Windows Serveril kasutatakse kontot Administrator):     <pre><code>ssh Administrator@windows_host\n</code></pre>     Sisse logides k\u00e4ivita k\u00e4sureal poweshell:     <pre><code>powershell\n</code></pre>     N\u00fc\u00fcd lisa Ansible CN v\u00f5ti \u00f5igesse kohta, k\u00e4sus asenda <code>&lt;avalik_ssh_v\u00f5ti&gt;</code> kopeeritud avaliku SSH v\u00f5tmega:      <pre><code>Add-Content -Path C:\\ProgramData\\ssh\\administrators_authorized_keys -Value \"&lt;avalik_ssh_v\u00f5ti&gt;\"\n</code></pre></p> </li> <li><code>administrators_authorized_keys</code>fail peab olema ainult Administrators ja SYSTEM kontrolli all, vastasel juhul OpenSSH keeldub seda kasutamast. Seega sea n\u00fc\u00fcd ka vajalikud \u00f5igused:     <pre><code>icacls.exe \"C:\\ProgramData\\ssh\\administrators_authorized_keys\" /inheritance:r /grant \"Administrators:F\" /grant \"SYSTEM:F\"\n</code></pre></li> <li>Taask\u00e4ivita SSH teenus:     <pre><code>Restart-Service sshd\n</code></pre></li> <li> <p>Katkesta SSH \u00fchenduse ja proovi uuesti \u00fchenduda:     <pre><code>ssh Administrator@windows_host\n</code></pre>     Kui eelnevad tegevused said korrektselt teostatud, siis toimub \u00fchendus n\u00fc\u00fcd ilma parooli k\u00fcsimata.</p> </li> <li> <p>Ansible peab teadma, kuidas Windowsi hostiga \u00fchendust v\u00f5tta.</p> <p>Inventory failis tuleb kirjeldada:</p> <ul> <li><code>ansible_host</code> - Windowsi hosti IP</li> <li><code>ansible_user</code> - kasutaja, millega \u00fchendutakse</li> <li><code>ansible_connection=ssh</code> - k\u00e4sib Ansible\u2019il kasutada OpenSSH-d (mitte WinRM-i)</li> <li><code>ansible_ssh_private_key_file</code> - \u00fctleb, millist v\u00f5tit kasutada (siin vaikimisi ~/.ssh/id_ed25519)</li> <li><code>ansible_shell_type: powershell</code> \u2013 \u00fctleb Ansible'ile, et k\u00e4sud tuleb k\u00e4ivitada PowerShellis. On vajalik, muidu Ansible eeldab CMD-d.</li> <li><code>ansible_shell_executable: powershell.exe</code> \u2013 m\u00e4\u00e4rab t\u00e4pse shelli k\u00e4ivitusfaili, mis on vajalik m\u00f5nes Windowsi versioonis, et v\u00e4ltida vigu nagu command not found.</li> </ul> <p>Inventrory n\u00e4ited:</p> <p><code>ini</code>: <pre><code>[winservers]\nwin1 ansible_host=192.168.56.101 ansible_user=Administrator ansible_connection=ssh ansible_ssh_private_key_file=~/.ssh/id_ed25519 ansible_shell_type=powershell ansible_shell_executable=powershell.exe\n</code></pre></p> <p><code>yaml</code>: <pre><code>all:\n  children:\n    winservers:\n      hosts:\n        win1:\n          ansible_host: 192.168.56.101\n          ansible_user: Administrator\n          ansible_connection: ssh\n          ansible_ssh_private_key_file: ~/.ssh/id_ed25519\n          ansible_shell_type: powershell\n          ansible_shell_executable: powershell.exe\n</code></pre></p> <p>Info</p> <p>Ansible'i inventory muutujad soovitatakse paigutada eraldi failidesse nagu group_vars ja host_vars, et hoida konfiguratsioon puhtana, korduvkasutatavana ja skaleeritavana. Seda vaatame t\u00e4psemalt aga hiljem.</p> </li> <li> <p>Kontrolli \u00fchendust Ansible\u2019iga</p> <p>Proovime kontrolliks Ansible abil k\u00e4ivitada ping moodulit (pane t\u00e4hele, et moodul, mida kasutame on teine kui Linuxil):</p> <p>N\u00e4ide:  <pre><code>ansible -i inventory/hosts.yml win1 -m win_ping\n</code></pre> v\u00f5i (kui inventory failile pole eraldi vaja viidata) <pre><code>ansible win1 -m win_ping\n</code></pre></p> <p>Kui k\u00f5ik t\u00f6\u00f6tab, saad \"ping\"-ile vastuseks \"pong\": <pre><code>win1 | SUCCESS =&gt; {\n  \"changed\": false,\n  \"ping\": \"pong\"\n}\n</code></pre></p> </li> </ol>"},{"location":"ansible/ansiblenodes/#windows-hosti-uhendamine-ansibleiga-winrm-abil","title":"Windows hosti \u00fchendamine Ansible'iga WinRM abil","text":"<p>Ansible toetab Windowsi haldamist WinRM (Windows Remote Management) kaudu, mis on PowerShell Remotingu alusprotokoll. See on Ansible\u2019i ametlikult soovitatud meetod Windowsi masinate haldamiseks. Vaikimisi t\u00f6\u00f6tab WinRM kr\u00fcpteerimata HTTP kaudu \u00fcle pordi 5985 \u2013 seda ei tohiks kasutada production-keskkonnas. Turvaliseks kasutamiseks tuleb seadistada HTTPS listener (port 5986) koos sertifikaadiga. Vaatamegi n\u00fc\u00fcd turvalist \u00fchendust:</p> <ol> <li> <p>Luba PowerShell Remoting Windowsi hostis</p> <p>Ava PowerShell administraatorina ja k\u00e4ivitage:  </p> <pre><code>Enable-PSRemoting -Force\n</code></pre> <p>See loob vajalikud WinRM-i listenerid ja lubab tulem\u00fc\u00fcri reeglid. </p> </li> <li> <p>Kontrolli WinRM-i olekut</p> <pre><code>winrm quickconfig\n</code></pre> <p><code>Do you want to Configure LocalAccountTokenFilterPolicy to grant administrative rights remotely to local users</code> - See k\u00fcsimus ilmub, sest winrm quickconfig soovib lubada kohalikul administraatorikontol s\u00e4ilitada t\u00e4is\u00f5igused ka kaug\u00fchenduse korral. Windowsi UAC (User Account Control) rakendab vaikimisi token filtering-it, mis eemaldab osa administraatori \u00f5igusi, kui \u00fchendus tuleb v\u00f5rgu kaudu. </p> <ul> <li>N\u00f5ustu muutusega, kui sul domeeni pole veel loodud.</li> <li>See muudatus ei ole vajalik, kui kasutad domeenikontot (nt Active Directory), sest UAC token filtering ei m\u00f5juta domeenikontosid.</li> </ul> </li> <li> <p>Loo sertifikaat (self-signed)</p> <p>Production keskkonnas soovitatakse kasutada CA poolt v\u00e4ljastatud sertifikaati. \u00d5ppimiseks sobib self-signed sertifikaat.</p> <p>N\u00e4ide sertifikaadi loomisest:</p> <pre><code>$cert = New-SelfSignedCertificate -DnsName \"win1.local\" -CertStoreLocation \"Cert:\\LocalMachine\\My\"\n</code></pre> <ul> <li><code>DnsName</code> v\u00e4\u00e4rtuseks pane oma serveri hostname v\u00f5i IP (nt 192.168.56.101).</li> <li><code>Cert:\\LocalMachine\\My</code>: Sertifikaat salvestatakse masinasse sertifikaadihoidlasse (LocalMachine\\My). <code>LocalMachine</code> - sertifikaat paigaldatakse arvuti tasemel (mitte ainult konkreetsele kasutajale). <code>My</code> - see on sertifikaadihoidla nimi (\"Personal\" store). Seal hoitakse arvuti/teenuse jaoks vajalikke isiklikke sertifikaate, mida saab kasutada nt kr\u00fcpteeritud \u00fchenduste loomiseks.</li> </ul> </li> <li> <p>HTTPS listeneri loomine WinRM-ile</p> <p>Leia sertifikaadi thumbprint: <pre><code>$cert.Thumbprint\n</code></pre></p> <p>Seej\u00e4rel loo uus HTTPS listener (muuda hostname selliseks nagu kasutasid sertifikaadi loomisel): <pre><code>winrm create winrm/config/Listener?Address=*+Transport=HTTPS \"@{Hostname=`\"win1.local`\"; CertificateThumbprint=`\"$($cert.Thumbprint)`\"}\"\n</code></pre></p> <p>Kontrolli, et listener lisandus: <pre><code>winrm enumerate winrm/config/Listener\n</code></pre></p> <p>N\u00fc\u00fcd kuulab WinRM porti 5986 (HTTPS).</p> </li> <li> <p>Tulem\u00fc\u00fcri seadistus</p> <p>Lisa reegel, mis lubab WinRM HTTPS liikluse (port 5986): <pre><code>New-NetFirewallRule -Name \"WinRM-HTTPS\" -DisplayName \"WinRM over HTTPS\" -Protocol TCP -LocalPort 5986 -Action Allow -Direction Inbound\n</code></pre></p> </li> <li> <p>Self-signed sertifikaadi lisamine Trusted Root Certification Authorities hoidlasse</p> <p>Otsi loodud sertifikaat My store'ist: <pre><code>$cert = Get-ChildItem -Path Cert:\\LocalMachine\\My | Where-Object { $_.DnsNameList -match \"win1.local\" }\n</code></pre> Ekspordi see failiks: <pre><code>Export-Certificate -Cert $cert -FilePath C:\\winrm-cert.cer\n</code></pre> Impordi see Trusted Root Certification Authorities alla: <pre><code>Import-Certificate -FilePath C:\\winrm-cert.cer -CertStoreLocation \"Cert:\\LocalMachine\\Root\"\n</code></pre> Testi \u00fchendust iseendaga (localhost), et kontrollida kas listener vastab: <pre><code>Test-WSMan -ComputerName \"win1.local\" -Port 5986 -UseSSL\n</code></pre></p> </li> <li> <p>Ansible inventory seadistamine</p> <p>Kui WinRM on seadistatud, tuleb Ansible\u2019is m\u00e4\u00e4rata \u00f5iged muutujad: </p> <ul> <li><code>ansible_connection=winrm</code> \u2013 m\u00e4\u00e4rab, et kasutatakse WinRM-i.</li> <li><code>ansible_winrm_transport</code> \u2013 autentimisprotokolli, tavaliselt ntlm, kuid v\u00f5ib olla ka credssp v\u00f5i kerberos (vt. tabelit).</li> <li><code>ansible_winrm_server_cert_validation=ignore</code> \u2013 \u00f5ppet\u00f6\u00f6s mugav, sest self-signed sert ei ole CA poolt usaldatud. Production\u2019is tuleks see panna validate ja kasutada CA sertifikaate.</li> <li><code>ansible_port=5986</code> \u2013 HTTPS port.</li> </ul> <p>N\u00e4iteks:</p> <p><code>ini</code>: <pre><code>[winservers]\nwin1 ansible_host=192.168.56.101 ansible_user=Administrator ansible_password=SalajaneParool ansible_connection=winrm ansible_winrm_transport=ntlm ansible_winrm_server_cert_validation=ignore ansible_port=5986\n</code></pre></p> <p><code>yaml</code>: <pre><code>all:\n  children:\n    winservers:\n      hosts:\n        win1:\n          ansible_host: 192.168.56.101\n          ansible_user: Administrator\n          ansible_password: \"SalajaneParool\"\n          ansible_connection: winrm\n          ansible_winrm_transport: ntlm\n          ansible_winrm_server_cert_validation: ignore\n          ansible_port: 5986\n</code></pre></p> <p>Warning</p> <p>Turvalisuse m\u00f5ttes tuleks paroolid hoida Ansible Vault abil, mitte otse inventory failis. Seda k\u00e4sitleme hiljem turvalisuse materjalis.  </p> <p>Autentimiprotokolli valik s\u00f5ltub keskkonnast:</p> Protokoll Kus kasutatakse Kirjeldus ntlm Tavaline kohalik v\u00f5i domeenikonto K\u00f5ige levinum meetod. Lihtne seadistada, sobib enamasti labori jaoks. credssp Kui vaja volitada mandaate edasi V\u00f5imaldab edastada mandaadid ka teistele masinatele. Vajab lisaseadistust. kerberos Active Directory domeenikeskkond K\u00f5ige turvalisem lahendus. Kasutab domeeni SSO-d, ei pea parooli k\u00e4sitsi sisestama. </li> <li> <p>Kontrolli \u00fchendust Ansible\u2019iga</p> <pre><code>ansible win1 -m win_ping\n</code></pre> <p>Kui k\u00f5ik on korras, n\u00e4ed v\u00e4ljundit: <pre><code>win1 | SUCCESS =&gt; {\n\"changed\": false,\n\"ping\": \"pong\"\n}\n</code></pre></p> </li> </ol>"},{"location":"ansible/ansiblenodes/#hostide-lisamise-head-tavad","title":"Hostide lisamise head tavad","text":"<ul> <li>Kasuta SSH v\u00f5tmeid SSH \u00fchenduste puhul hostidega \u2013 \u00e4ra kasuta paroole inventuuri failides.  </li> <li>Kasuta Ansible Vault\u2019i paroolide turvaliseks hoidmiseks.  </li> <li>Kontrolli alati \u00fchendust <code>ping</code> mooduliga enne, kui jooksutad keerukamaid playbooke.  </li> <li>Hoia Linuxi ja Windowsi hostid eraldi gruppides.  </li> <li>Grupeeri hostid loogiliselt (nt webservers, dbservers, test, prod) \u2013 see lihtsustab playbookide haldamist.</li> <li>Kasuta alias-nimesid hostide jaoks, et v\u00e4ltida IP-aadresside kasutamist otse playbookides. See muudab konfiguratsiooni loetavamaks ja paremini hallatavaks.</li> </ul>"},{"location":"ansible/ansiblenodes/#rohkem-infot","title":"Rohkem infot","text":"<ul> <li>Connecting to Linux Hosts </li> <li>Connecting to Windows Hosts </li> <li>WinRM Setup Guide </li> </ul>"},{"location":"ansible/ansibleplaybooks/","title":"Playbookid ja YAML","text":""},{"location":"ansible/ansibleplaybooks/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Mis on Playbook</li> <li>Mis on YAML ja selle p\u00f5hit\u00f5ed </li> <li>Milline on playbooki \u00fclesehitus</li> <li>Kuidas playbooke k\u00e4ivitada </li> </ul>"},{"location":"ansible/ansibleplaybooks/#mis-on-playbook","title":"Mis on Playbook?","text":"<p>Playbook on Ansible keskne osa, kus kirjeldatakse samm-sammult, mida masinates teha tuleb. Kui Ansible k\u00e4sud on nagu \u00fcksikud k\u00e4sklused, siis playbook on nagu skript, mis need k\u00e4sud j\u00e4rjest t\u00e4idab. Playbookid kirjutatakse YAML formaadis, mis on loetav ja lihtne struktuurne keel.</p> <p>Playbook v\u00f5imaldab:</p> <ul> <li>Korrata tegevusi usaldusv\u00e4\u00e4rselt mitmes masinas korraga</li> <li>Dokumenteerida, mida t\u00e4pselt tehakse</li> <li>Automatiseerida keerulisemaid t\u00f6\u00f6vooge (nt tarkvara paigaldus, teenuste seadistamine)</li> </ul>"},{"location":"ansible/ansibleplaybooks/#yaml-pohitoed","title":"YAML p\u00f5hit\u00f5ed","text":"<p>YAML (YAML Ain\u2019t Markup Language) on lihtne andmevorming, mida Ansible kasutab playbookide jaoks.</p> <p>Olulised reeglid:</p> <ul> <li>Taandamine (indentation) t\u00fchikutega, mitte tab-idega. T\u00fchikute arv taandamisel on vaba, aga peab olema j\u00e4rjepidev (standardiks on 2 t\u00fchikut). </li> <li>V\u00f5tme-v\u00e4\u00e4rtuse paarid: <code>v\u00f5ti: v\u00e4\u00e4rtus</code></li> <li>Loetelud: <code>- element</code></li> <li>S\u00f5numite v\u00f5i k\u00e4skude kirjeldused v\u00f5ivad olla jutum\u00e4rkides kui sisaldavad eris\u00fcmboleid</li> <li><code>---</code> faili alguses pole Ansible jaoks kohustuslik, aga on YAML standardi osa</li> <li>YAML-is ei tohi kasutada <code>:</code> s\u00fcmbolit v\u00e4\u00e4rtuses ilma jutum\u00e4rkideta</li> </ul> <p>N\u00e4ide:</p> <pre><code>---\n- name: N\u00e4ide YAML loendist\n  hosts: all\n  tasks:\n    - name: Kontrolli \u00fchendust\n      ping:\n    - name: Loo kataloog\n      file:\n        path: /tmp/minu_kataloog\n        state: directory\n</code></pre>"},{"location":"ansible/ansibleplaybooks/#playbooki-ulesehitus","title":"Playbooki \u00fclesehitus","text":"<p>Playbook koosneb \u00fchest v\u00f5i mitmest play'st. Iga play \u00fctleb:</p> <ol> <li>Milliseid hoste see puudutab</li> <li>Milliseid \u00fclesandeid (tasks) tuleb teha</li> </ol> <p>Play = seos hostide ja tasks'ide vahel. Task = \u00fcks konkreetne tegevus mooduliga.</p> <p>Kui \u00fche play all on palju tasks\u2019e, t\u00e4idetakse need j\u00e4rjestikku.</p>"},{"location":"ansible/ansibleplaybooks/#vaike-naide-nginx-veebiserveri-paigaldamine-debiani-laadsetele-linuxitele","title":"V\u00e4ike n\u00e4ide (nginx veebiserveri paigaldamine Debiani laadsetele Linuxitele)","text":"<pre><code>---\n- name: Lihtne playbook\n  hosts: webservers\n  become: yes\n  tasks:\n    - name: Paigalda NGINX\n      apt:\n        name: nginx\n        state: present\n\n    - name: K\u00e4ivita NGINX\n      service:\n        name: nginx\n        state: started\n        enabled: yes\n</code></pre> <p>Selgitus:</p> <ul> <li><code>hosts: webservers</code> - see play rakendub gruppi \u201ewebservers\u201d kuuluvatele hostidele  </li> <li><code>become: yes</code> - k\u00e4sud tehakse sudo \u00f5igustes  </li> <li><code>apt:</code> ja <code>service:</code> - moodulid, millega vastav tegevus tehakse  </li> </ul>"},{"location":"ansible/ansibleplaybooks/#playbooki-kaivitamine","title":"Playbooki k\u00e4ivitamine","text":"<p>Playbook k\u00e4ivitatakse k\u00e4suga:</p> <pre><code>ansible-playbook failinimi.yml\n</code></pre> <p>Info</p> <p>Kui inventory pole vaikimisi m\u00e4\u00e4ratud, tuleb kasutada ka <code>-i</code> lippu</p> <p>N\u00e4iteks:</p> <pre><code>ansible-playbook paigalda_nginx.yml\n</code></pre> <p>Kui tahad testida ainult \u00fche hosti peal:</p> <pre><code>ansible-playbook paigalda_nginx.yml -l web1\n</code></pre> <p>Kui tahad ainult n\u00e4ha, mida tehakse (tegelikult ei k\u00e4ivitata):</p> <pre><code>ansible-playbook paigalda_nginx.yml --check\n</code></pre> <p>Info</p> <p><code>--check</code> ei garanteeri 100% identsust tegeliku k\u00e4ivitamisega (nt m\u00f5ne mooduli puhul ei saa muutust ette ennustada)</p> <p>Playbookid, mis vajavad  \u00fclesannete (tasks) jaoks become (sudo) \u00f5igusi, saab k\u00e4ivitada nii:</p> <pre><code>ansible-playbook paigalda_nginx.yml -l web1 --become\n</code></pre>"},{"location":"ansible/ansibleplaybooks/#kasulikud-lisaparameetrid-kaivitamisel","title":"Kasulikud lisaparameetrid k\u00e4ivitamisel","text":"<p>Kui tahad rohkem infot n\u00e4ha, kasuta verbose lippu <code>-v</code> (v\u00f5i <code>-vvv</code> detailsema logi jaoks):</p> <pre><code>ansible-playbook paigalda_nginx.yml -v\nansible-playbook paigalda_nginx.yml -vvv\n</code></pre> <ul> <li><code>-v</code> - n\u00e4itab l\u00fchikest lisainfot, nt millised k\u00e4sud jooksevad.</li> <li><code>-vvv</code> - n\u00e4itab v\u00e4ga detailset infot, sh mooduli t\u00e4pseid k\u00e4ske ja \u00fchenduse logi (hea veaotsinguks).</li> </ul> <p>Kui tahad n\u00e4ha, mida muudetakse (eriti konfiguratsioonifailide puhul), kasuta --diff lippu. <code>--diff</code> lipp v\u00f5rdleb hosti praegust seisundit (n\u00e4iteks faili sisu v\u00f5i teenuse olekut) ja seda, millisesse seisundisse playbook tahab selle viia.</p> <pre><code>ansible-playbook seadista_nginx.yml --diff\n</code></pre>"},{"location":"ansible/ansibleplaybooks/#tulemuste-salvestamine-ja-kuvamine","title":"Tulemuste salvestamine ja kuvamine","text":"<p>Sageli on vaja n\u00e4ha, mida m\u00f5ni moodul tegelikult tagastab, et oma playbooke paremini m\u00f5ista ja testida. Selleks kasutatakse kaht kasulikku t\u00f6\u00f6riista:</p> <ul> <li><code>register:</code> \u2013 salvestab mooduli v\u00e4ljundi muutujasse. V\u00f5imaldab kasutada mooduli v\u00e4ljundit hilisemates taskides.</li> <li><code>debug:</code> \u2013 kuvab muutuja v\u00e4\u00e4rtuse ekraanile. Aitab \u00f5ppimise ja veaotsingu k\u00e4igus n\u00e4ha, mida Ansible tegelikult teeb.</li> </ul> <pre><code>- name: Kontrolli \u00fchendust\n  hosts: webservers\n  tasks:\n    - name: Tee ping test\n      ping:\n      register: pingitulemus     # salvestame tulemuse muutujasse\n\n    - name: Kuvame tulemuse\n      debug:\n        var: pingitulemus        # n\u00e4itame, mis v\u00e4\u00e4rtused tagastati\n</code></pre> <p>Kasulikud nipid</p> <p>Kui tahad kuvada ainult \u00fche v\u00e4\u00e4rtuse:</p> <pre><code>    - name: Kuvame tulemuse\n      debug:\n        msg: \"Server vastas: {{ pingitulemus.ping }}\"\n</code></pre> <p>Kui tahad testida muutujate olemasolu: </p> <pre><code>    - name: Muutujate test\n      debug:\n        var: ansible_facts['os_family']\n</code></pre>"},{"location":"ansible/ansibleplaybooks/#head-tavad-playbookide-kirjutamisel","title":"Head tavad playbookide kirjutamisel","text":"<ul> <li>Hoia lihtsana \u2013 tee playbookid loetavaks, et ka teised (v\u00f5i sina ise hiljem) saaksid aru, mida need teevad.</li> <li>Kasuta selgeid nimesid \u2013 igal task\u2019il peaks olema <code>name:</code> v\u00e4li, mis kirjeldab t\u00e4pselt, mis toimub.</li> <li>Testi <code>--check</code> re\u017eiimis enne p\u00e4ris k\u00e4ivitamist.</li> <li>Kasuta muutujad korduvate v\u00e4\u00e4rtuste jaoks (nt kataloogiteed, paketid).</li> <li>Grupeeri hostid loogiliselt inventorys (nt <code>webservers</code>, <code>dbservers</code>).</li> <li>Kasuta rolle kui playbook muutub suureks \u2013 rollid aitavad hoida koodi korrastatuna.</li> <li>\u00c4ra kasuta \"shell\" v\u00f5i \"command\" moodulit ilma vajaduseta \u2013 eelista spetsiaalseid mooduleid (<code>apt</code>, <code>service</code>, <code>file</code> jne).</li> <li>Versioonihaldus (git) \u2013 hoia playbookid ja inventory git\u2019is, et oleks v\u00f5imalik muudatusi j\u00e4lgida.</li> <li>Kommentaarid YAML-is: <code>#</code> \u2013 aitab enda jaoks kommentaare ja m\u00e4rkmeid teha.</li> <li>Idempotentsus: - Ansible \u00fclesanded peaksid olema korduvk\u00e4ivitatavad, muutmata midagi kui s\u00fcsteem on juba soovitud seisundis.</li> </ul>"},{"location":"ansible/ansibleplaybooks/#playbookide-kvaliteedi-kontroll-ansible-lint","title":"Playbookide kvaliteedi kontroll: <code>ansible-lint</code>","text":"<p>Kui oled kirjutanud oma esimese playbooki, v\u00f5ib olla raske m\u00e4rgata, kas k\u00f5ik on tehtud parimate tavade j\u00e4rgi. Siin tuleb appi t\u00f6\u00f6riist <code>ansible-lint</code> \u2013 see on lihtne programm, mis kontrollib playbooke ja rolle ning annab vihjeid, kuidas neid paremaks muuta.</p> <p><code>ansible-lint</code> aitab n\u00e4iteks:</p> <ul> <li>Leida valesti kasutatud v\u00f5i vananenud mooduleid</li> <li>M\u00e4rgata YAML-i s\u00fcntaksi probleeme</li> <li>Soovitada paremaid praktikaid (nt muutujate ja tingimuste kasutamisel)</li> <li>Tagada, et sinu playbook oleks \u00fchtlaselt loetav ja hooldatav</li> </ul> <p>N\u00e4ide kasutamisest:</p> <pre><code>ansible-lint minu_playbook.yml\n</code></pre> <p>T\u00f6\u00f6riist ei ole vaikimisi Ansible\u2019iga kaasas, vaid tuleb eraldi paigaldada. Olenevalt kuidas Ansible on paigaldatud, saad selle paigaldada nii:</p> <pre><code>apt install ansible-lint  # pakihaldurist\npipx install ansible-lint  # pipx abil\npip install ansible-lint  # pip abil\n</code></pre>"},{"location":"ansible/ansibleplaybooks/#rohkem-infot","title":"Rohkem infot","text":"<ul> <li>Ansible playbooks </li> <li>YAML Syntax </li> </ul>"},{"location":"ansible/ansibleroles/","title":"Ansible rollid ja struktuur","text":""},{"location":"ansible/ansibleroles/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Mis on rollid ja miks neid kasutatakse</li> <li>Kuidas rolli struktuur t\u00f6\u00f6tab</li> <li>Kuidas luua rolle automaatselt <code>ansible-galaxy</code> k\u00e4suga</li> <li>Kuidas kasutada rolle playbookides</li> <li>Kuidas integreerida muutujaid, malle, faile, handler'eid rolli sees</li> </ul>"},{"location":"ansible/ansibleroles/#mis-on-rollid","title":"Mis on rollid?","text":"<p>Kui projektikaust ja playbookid muutuvad suureks ja keeruliseks, on raskem:</p> <ul> <li>anal\u00fc\u00fcsida, mis kus toimub</li> <li>taaskasutada sama loogikat</li> <li>hoida koodi puhtana</li> <li>teha muudatusi ilma riske kasvatamata</li> </ul> <p>Rollid on viis Ansible kood jagada eraldi, h\u00e4sti organiseeritud komponentideks.</p> <p>Rollis saab hoida:</p> <ul> <li>\u00fclesandeid (tasks)</li> <li>muutujaid</li> <li>malle</li> <li>faile</li> <li>handler'eid</li> <li>pakette, seadistusi, teenuseid</li> </ul> <p>N\u00e4iteks v\u00f5ib sul olla rollid nagu:</p> <ul> <li><code>nginx</code></li> <li><code>docker</code></li> <li><code>users</code></li> <li><code>firewall</code></li> </ul> <p>Need muudavad koodi korduvkasutatavaks nii sinu kui ka teiste jaoks.</p>"},{"location":"ansible/ansibleroles/#rolli-kataloogistruktuur","title":"Rolli kataloogistruktuur","text":"<p>Ansible roll on nagu kapseldatud t\u00f6\u00f6voog, mis sisaldab k\u00f5iki vajalikke komponente (\u00fclesanded, muutujad, mallid, failid jne), et t\u00e4ita kindlat konfiguratsioonieesm\u00e4rki. T\u00fc\u00fcpiline rolli struktuur n\u00e4eb v\u00e4lja selline:</p> <pre><code>myproject/\n\u251c\u2500 roles/\n\u2502 \u2514\u2500 nginx/\n\u2502 \u251c\u2500 tasks/\n\u2502 \u2502 \u2514\u2500 main.yml\n\u2502 \u251c\u2500 handlers/\n\u2502 \u2502 \u2514\u2500 main.yml\n\u2502 \u251c\u2500 templates/\n\u2502 \u2502 \u2514\u2500 nginx.conf.j2\n\u2502 \u251c\u2500 files/\n\u2502 \u251c\u2500 vars/\n\u2502 \u2502 \u2514\u2500 main.yml\n\u2502 \u251c\u2500 defaults/\n\u2502 \u2502 \u2514\u2500 main.yml\n\u2502 \u2514\u2500 meta/\n\u2502 \u2514\u2500 main.yml\n\u2514\u2500 site.yml\n</code></pre> <p>Rolli k\u00f5ige olulisem fail on:</p> <p><code>roles/ROLLINIMI/tasks/main.yml</code></p> <p>Siit k\u00e4ivitab Ansible rolli t\u00f6\u00f6voo. See fail sisaldab \u00fclesandeid, mida roll t\u00e4idab. Kui rolli kutsutakse roles: direktiiviga playbookis, siis Ansible alustab t\u00e4itmist just sellest failist. Ehk \u00fclesanded (tasks), mis muidu oleks otse playbooki sees, liiguvad rollide puhul tasks/main.yml faili.</p> <p>Failis v\u00f5ivad olla:</p> <ul> <li>konkreetseid \u00fclesandeid</li> <li>viiteid teistele failidele</li> <li>tingimuslikud k\u00e4sud</li> </ul>"},{"location":"ansible/ansibleroles/#rolli-loomine-ansible-galaxy-kasuga","title":"Rolli loomine <code>ansible-galaxy</code> k\u00e4suga","text":"<p>Rolli struktuuri ei pea k\u00e4sitsi looma, seda saab automaatselt teha <code>ansible-galaxy</code> k\u00e4suga. Nii on palju lihtsam:</p> <pre><code>ansible-galaxy init nginx\n</code></pre> <p>See loob automaatselt kataloogi ja \u00f5iged failid. Antud n\u00e4ite puhul luuakse uus Ansible roll nimega nginx.</p>"},{"location":"ansible/ansibleroles/#rolli-kasutamine-playbookis","title":"Rolli kasutamine playbook'is","text":"<p>Kui kasutatakse rolle, siis projektikausta playbookis viidatakse neile <code>roles:</code> parameetriga. Playbook v\u00f5ib v\u00e4lja n\u00e4ha n\u00e4iteks nii:</p> <p><pre><code>---\n- name: Veebiserverite seadistamine\n  hosts: webservers\n  become: yes\n\n  roles:\n    - nginx\n</code></pre> Ansible otsib rolli kataloogist <code>roles/nginx/</code>.</p>"},{"location":"ansible/ansibleroles/#mitme-rolli-kasutamine","title":"Mitme rolli kasutamine","text":"<p>N\u00e4ide playbookist kus kasutusel on 4 erinevat rolli:</p> <p><pre><code>---\n- name: Serverite seadistamine\n  hosts: webservers\n  become: yes\n\n  roles:\n    - common\n    - firewall\n    - docker\n    - nginx\n</code></pre> Ansible t\u00e4idab rollid \u00fclalt alla j\u00e4rjestuses.</p> <p>Kaustastruktuur n\u00e4eks v\u00e4lja selline:</p> <pre><code>myproject/\n\u251c\u2500 server.yml\n\u251c\u2500 inventory\n\u2514\u2500 roles/\n   \u251c\u2500 common/\n   \u251c\u2500 nginx/\n   \u251c\u2500 docker/\n   \u251c\u2500 firewall/\n</code></pre>"},{"location":"ansible/ansibleroles/#rolli-kasutamine-handleri-puhul","title":"Rolli kasutamine handleri puhul","text":"<p>J\u00e4rgnevalt n\u00e4ide rollist, kus kasutusel on <code>notify</code> koos <code>handler</code>-iga:</p> <p>Fail <code>tasks/main.yml</code>:</p> <pre><code>- name: Paigalda nginx konfiguratsioon\n  template:\n    src: nginx.conf.j2\n    dest: /etc/nginx/nginx.conf\n  notify: Taask\u00e4ivita nginx\n</code></pre> <p>Fail <code>handlers/main.yml</code>:</p> <pre><code>- name: Taask\u00e4ivita nginx\n  service:\n    name: nginx\n    state: restarted\n</code></pre> <p>See k\u00e4ivitab teenuse ainult siis, kui mall muutus.</p>"},{"location":"ansible/ansibleroles/#rolli-sees-olevad-pohikomponendid","title":"Rolli sees olevad p\u00f5hikomponendid","text":""},{"location":"ansible/ansibleroles/#tasksmainyml","title":"<code>tasks/main.yml</code>","text":"<p>Siia l\u00e4hevad rolli p\u00f5hitegevused. N\u00e4iteks:</p> <pre><code>---\n- name: Paigalda nginx\n  apt:\n    name: nginx\n    state: present\n\n- name: K\u00e4ivita nginx\n  service:\n    name: nginx\n    state: started\n    enabled: true\n</code></pre>"},{"location":"ansible/ansibleroles/#handlersmainyml","title":"<code>handlers/main.yml</code>","text":"<p>Kui rollis on kasutusel handlers, siis pannakse need sellesse faili. N\u00e4iteks:</p> <pre><code>---\n- name: Taask\u00e4ivita nginx\n  service:\n    name: nginx\n    state: restarted\n</code></pre>"},{"location":"ansible/ansibleroles/#templates","title":"<code>templates/</code>","text":"<p>Kui rollis kasutatakse malle, siis siia kasuta pannakse mallifailid (Jinja2 .j2). N\u00e4iteks:</p> <p><code>nginx.conf.j2</code></p>"},{"location":"ansible/ansibleroles/#rolli-muutujad","title":"Rolli muutujad","text":"<p>Rollides on kaks peamist muutujate kohta:</p> <p><code>defaults/main.yml</code></p> <ul> <li>madalaim prioriteet</li> <li>saab h\u00f5lpsasti playbookis \u00fcle kirjutada</li> </ul> <p>N\u00e4ide faili sisust:</p> <p><code>nginx_port: 80</code></p> <p><code>vars/main.yml</code></p> <ul> <li>k\u00f5rgem prioriteet</li> <li>tavaliselt kasutatakse rollisisesteks konstantideks</li> </ul> Prioriteet Allikas Kirjeldus 1 (k\u00f5rgeim) <code>--extra-vars</code> K\u00f5ige k\u00f5rgema prioriteediga \u2013 need kirjutavad \u00fcle k\u00f5ik muud v\u00e4\u00e4rtused. 2 Playbooki <code>vars:</code> <code>vars:</code> plokis m\u00e4\u00e4ratud muutujad playbookis. 3 Inventari muutujad Hostivarad (<code>host_vars</code>), grupivarad (<code>group_vars</code>), inventarifailis m\u00e4\u00e4ratud muutujad. 4 Rolli <code>vars/main.yml</code> K\u00f5rgema prioriteediga kui <code>defaults</code>, kuid madalam kui playbooki <code>vars</code>. 5 (madalaim) Rolli <code>defaults/main.yml</code> Rolli k\u00f5ige madalama prioriteediga muutujad. Kasutatakse vaikimisi v\u00e4\u00e4rtustena, mida saab hiljem \u00fcle kirjutada."},{"location":"ansible/ansibleroles/#ansible-galaxy-rollid-vorgust","title":"Ansible Galaxy rollid (v\u00f5rgust)","text":"<p>Ansible Galaxy on Ansible'i ametlik veebip\u00f5hine keskkond, kust saab otsida, jagada ja installida valmis rolle. See toimib nagu pakihaldur Ansible rollide jaoks.</p> <p>Otsimine:</p> <p>Selle abil saab n\u00e4iteks otsida v\u00f5rgust rolli, mis paigaldab ja konfigureerib Nginx veebiserveri:</p> <p><code>ansible-galaxy search nginx</code></p> <p>See kuvab nimekirja rollidest, mis on seotud Nginx-iga \u2013 koos autorite, hinnangute ja kirjeldusega.</p> <p>Info</p> <p>Galaxy rollid v\u00f5ivad olla erineva kvaliteediga \u2013 soovitatav on vaadata reitingu, allalaadimiste arvu ja dokumentatsiooni enne kasutamist.</p> <p>Installeerimine:</p> <p>Kui leiad sobiva rolli, saad selle lihtsalt installida oma projekti <code>roles/</code>kausta. N\u00e4iteks:</p> <p><code>ansible-galaxy install geerlingguy.nginx -p roles/</code></p> <p>See laeb rolli alla ja paigutab selle sinu projekti roles/ kausta (v\u00f5i teise m\u00e4\u00e4ratud asukohta).</p> <p>P\u00e4rast seda tekib sinu projekti selline struktuur:</p> <pre><code>ansible/\n\u251c\u2500\u2500 playbook.yml\n\u2514\u2500\u2500 roles/\n    \u2514\u2500\u2500 geerlingguy.nginx/\n</code></pre> <p>N\u00fc\u00fcd saad rolli kasutada playbook\u2019is, n\u00e4iteks:</p> <pre><code>---\n- hosts: web\n  become: true\n  roles:\n    - geerlingguy.nginx\n</code></pre> <p>Kui k\u00f5ik on valmis, k\u00e4ivita:</p> <p><code>ansible-playbook playbook.yml</code></p> <p>Roll teeb k\u00f5ik vajaliku Nginxi paigaldamiseks ja seadistamiseks. </p> <p>Vajadusel kohanda rolli oma soovide j\u00e4rgi. Enne kasutamist vaata rolliga kaasas olevat <code>README.md</code> faili, et n\u00e4ha muutujaid ja n\u00e4iteid.</p> <p>Rollide loomine ja jagamine</p> <p>Sa saad soovi korral sinu enda loodud rolli registreerida Galaxy keskkonnas, et teised saaksid seda kasutada. Selleks tuleb rollile lisada meta/main.yml fail, kus on info rolli kohta (autor, s\u00f5ltuvused jne).</p> <p>Rollide halduse automatiseerimine</p> <p>Kui projektis on vaja mitut rolli v\u00f5i soovid, et saaksid need lihtsalt \u00fche k\u00e4suga alla laadida, kasuta faili nimega <code>requirements.yml</code>.</p> <p>Kasutades <code>requirements.yml</code> faili, saad m\u00e4\u00e4rata k\u00f5ik vajalikud rollid ja nende versioonid. N\u00e4iteks:</p> <p><pre><code>- src: geerlingguy.nginx\n  version: 3.1.0\n- src: git+https://github.com/sinuorg/rollid.git\n  name: minu_roll\n</code></pre> Ja installida need k\u00f5ik korraga:</p> <p><code>ansible-galaxy install -r requirements.yml -p roles/</code></p> <p><code>version:</code> on valikuline \u2013 kui j\u00e4tad v\u00e4lja, paigaldatakse viimane saadaval versioon.</p> <p>Kui soovid k\u00f5ik rollid uuesti (v\u00f5i uuemad versioonid) alla laadida:</p> <p><code>ansible-galaxy install -r requirements.yml -p roles/ --force</code></p>"},{"location":"ansible/ansibleroles/#rollide-sees-teiste-failidele-viitamine","title":"Rollide sees teiste failidele viitamine","text":"<p>Ansible rollides on kindel kaustastruktuur, mis v\u00f5imaldab viidata failidele lihtsalt nime j\u00e4rgi, ilma et peaks m\u00e4\u00e4rama t\u00e4isteed. See teeb rollide kasutamise mugavamaks ja koodi loetavamaks.</p> <p>N\u00e4iteks mall asukohas:</p> <p><code>roles/nginx/templates/nginx.conf.j2</code></p> <p>Playbookis v\u00f5i rolli taskis viitamine:</p> <p><pre><code>- name: Loo Nginx konfiguratsioon\n  ansible.builtin.template:\n    src: nginx.conf.j2\n    dest: /etc/nginx/nginx.conf\n</code></pre> Ei pea andma t\u00e4isteed \u2013 Ansible leiab rolli templates/ kataloogist automaatselt.</p>"},{"location":"ansible/ansibleroles/#rohkem-infot","title":"Rohkem infot","text":"<ul> <li> <p>Ansible Roles Documentation</p> </li> <li> <p>Ansible Galaxy</p> </li> </ul>"},{"location":"ansible/ansiblevars/","title":"Muutujad ja nende kasutamine","text":""},{"location":"ansible/ansiblevars/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Mis on Ansible muutujad ja miks neid kasutada</li> <li>Kuidas ja kus m\u00e4\u00e4rata muutujate v\u00e4\u00e4rtusi</li> <li>Kus muutujad asuvad (vars, group_vars, host_vars, k\u00e4surealt jne)</li> <li>Muutujate loomise head tavad</li> </ul>"},{"location":"ansible/ansiblevars/#mis-on-muutujad","title":"Mis on muutujad?","text":"<p>Muutujad v\u00f5imaldavad hoida korduvaid v\u00e4\u00e4rtusi \u00fches kohas. See muudab playbookid lihtsamaks, loetavamaks ja hooldatavamaks. Sageli on mugav hoida korduvaid v\u00e4\u00e4rtusi (nt kataloogiteed, paketid v\u00f5i pordid) muutujates. See teeb playbooki l\u00fchemaks ja h\u00f5lpsamini hallatavaks.</p> <p>Muutujaid saab m\u00e4\u00e4rata mitmel tasemel. Kui sama muutuja on m\u00e4\u00e4ratud mitmes kohas, peab Ansible otsustama, millist v\u00e4\u00e4rtust kasutada. Ansible kasutab prioriteetide hierarhiat, kus k\u00f5rgema taseme v\u00e4\u00e4rtus asendab madalama oma.  </p> <p>Allpool on levinumad tasemed (madalaimast k\u00f5rgeimani):</p> Tasand N\u00e4ide / Asukoht Prioriteet Role defaults <code>defaults/main.yml</code> \ud83d\udd3d madalaim Inventory grupimuutujad <code>group_vars/webservers.yml</code> \u2191 Inventory hostimuutujad <code>host_vars/web1.yml</code> \u2191 Playbooki <code>vars:</code> Playbooki sees m\u00e4\u00e4ratud <code>vars:</code> \u2191 Playbooki <code>vars_files:</code> Playbooki sees viidatud eraldi failid \u2191 <code>set_fact</code> \u00fclesanded M\u00e4\u00e4ratud k\u00e4ivitamise ajal \u2191 K\u00e4surea muutujad <code>-e \"var=value\"</code> \ud83d\udd3c k\u00f5rgeim"},{"location":"ansible/ansiblevars/#olulisemad-muutujate-maaramise-viisid","title":"Olulisemad muutujate m\u00e4\u00e4ramise viisid","text":""},{"location":"ansible/ansiblevars/#muutujate-maaramine-playbooki-sees","title":"Muutujate m\u00e4\u00e4ramine Playbooki sees","text":"<p>Muutujad saab defineerida playbooki sees v\u00f5tme <code>vars:</code> all.</p> <p>N\u00e4ide:</p> <pre><code>---\n- name: Muutujate n\u00e4ide\n  hosts: webservers\n  become: yes\n\n  vars:\n    web_package: nginx\n    web_root: /var/www/html\n\n  tasks:\n    - name: Paigalda veebiserver\n      apt:\n        name: \"{{ web_package }}\"\n        state: present\n\n    - name: Loo veebikataloog\n      file:\n        path: \"{{ web_root }}/demo\"\n        state: directory\n        owner: www-data\n        group: www-data\n        mode: '0755'\n</code></pre> <p>Selgitus:</p> <ul> <li><code>vars:</code> all defineeritakse muutujad web_package ja web_root.</li> <li>Muutujaid kasutatakse topeltlainelistes sulgudes {{ }}.</li> <li>Kui muutuja v\u00e4\u00e4rtust hiljem muuta, ei pea seda igal pool k\u00e4sitsi asendama.</li> </ul> <p>Info</p> <p>Kui muutujad on pikemad v\u00f5i peavad kehtima mitmes playbookis, tasub need hoida eraldi failides (nt group_vars/ v\u00f5i host_vars/ kataloogides).</p>"},{"location":"ansible/ansiblevars/#muutujad-eraldi-failis-group_vars-voi-host_vars","title":"Muutujad eraldi failis (group_vars v\u00f5i host_vars)","text":"<p>N\u00e4ide:</p> <p>Kataloogistruktuur: <pre><code>inventory/\n\u251c\u2500 hosts.yaml\n\u251c\u2500 group_vars/\n\u2502  \u2514\u2500 webservers.yml\n\u251c\u2500 host_vars/\n\u2502  \u2514\u2500 web1.yml\n</code></pre></p> <p>Kui vajad, et erinevad grupid kasutaksid eri v\u00e4\u00e4rtusi, on mugav kasutada <code>group_vars/</code> kataloogi.</p> <p>Fail <code>group_vars/webservers.yml</code> sisu: <pre><code>web_package: nginx\nweb_root: /var/www/html\n</code></pre> Playbook kasutab neid muutujad automaatselt, kui <code>hosts:</code> m\u00e4\u00e4ratud grupp on <code>webservers</code>.</p> <p>Kui vajad, et erinevad hostid kasutaksid eri v\u00e4\u00e4rtusi, on mugav kasutada <code>host_vars/</code> kataloogi.</p> <p>Fail <code>host_vars/web1.yml</code> sisu: <pre><code>web_package: nginx\nweb_root: /var/www/html\n</code></pre> Playbook kasutab neid muutujad automaatselt, kui <code>hosts:</code> m\u00e4\u00e4ratud on <code>web1</code>.</p> <p>Info</p> <p>host_vars/ kataloogis olev fail peab kandma sama nime kui inventory\u2019s m\u00e4\u00e4ratud host.    </p>"},{"location":"ansible/ansiblevars/#muutujate-maaramine-kasurealt","title":"Muutujate m\u00e4\u00e4ramine k\u00e4surealt","text":"<p>N\u00e4ide:</p> <pre><code>ansible-playbook site.yml -e \"web_package=nginx\"\n</code></pre>"},{"location":"ansible/ansiblevars/#muutujate-maaramine-inventory-failis","title":"Muutujate m\u00e4\u00e4ramine inventory failis","text":"<p>Seda v\u00f5imalust vaatasime ka juba inventory materjalis. YAML-formaadis inventory on eelistatud, kuna see toetab keerukamaid andmestruktuure (nt loendid ja s\u00f5nastikud) ning on paremini loetav ja hallatav.</p> <p>N\u00e4ide: </p> <pre><code>[webservers]\nweb1 web_package=nginx web_root=/var/www/html\n</code></pre> <pre><code>all:\n  children:\n    webservers:\n      hosts:\n        web1:\n          ansible_host: 192.168.56.11\n          web_package: nginx\n          web_root: /var/www/html\n</code></pre>"},{"location":"ansible/ansiblevars/#muutujate-kasutamine-ulesannetes","title":"Muutujate kasutamine \u00fclesannetes","text":"<p>Muutujaid kasutatakse Ansible playbookis topeltlainelistes sulgudes <code>{{ }}</code>.</p> <p>N\u00e4ide:</p> <pre><code>- name: Loo kataloog\n  file:\n    path: \"{{ web_root }}/demo\"\n    state: directory\n</code></pre> <p>Ansible asendab <code>{{ web_root }}</code> playbooki k\u00e4ivitamisel vastava v\u00e4\u00e4rtusega.</p>"},{"location":"ansible/ansiblevars/#loendite-list-kasutamine","title":"Loendite (list) kasutamine","text":"<p>Sageli on vaja teha sama tegevust mitme v\u00e4\u00e4rtusega (nt paigaldada mitu paketti v\u00f5i luua mitu kataloogi). Sellisel juhul on mugav m\u00e4\u00e4rata v\u00e4\u00e4rtused loendina (list) ja kasutada neid ts\u00fckliga <code>loop:</code>. T\u00e4psemalt on k\u00fcll ts\u00fcklitest r\u00e4\u00e4gitud  \"Ts\u00fcklid\" teemas, aga v\u00e4ike n\u00e4ide ei tee ka siin paha.</p> <p>N\u00e4ide: </p> <pre><code>---\n- name: Paigalda mitmeid pakette\n  hosts: webservers\n  become: yes\n\n  vars:\n    packages:\n      - nginx\n      - curl\n      - vim\n\n  tasks:\n    - name: Paigalda vajalikud paketid\n      apt:\n        name: \"{{ item }}\"\n        state: present\n      loop: \"{{ packages }}\"\n</code></pre>"},{"location":"ansible/ansiblevars/#muutujate-andmetuubid","title":"Muutujate andmet\u00fc\u00fcbid","text":"<p>Ansible kasutab YAML-andmet\u00fc\u00fcpe. Muutujad ei ole ainult tekst (string), vaid v\u00f5ivad olla ka numbrid, t\u00f5ev\u00e4\u00e4rtused, loendid ja s\u00f5nastikud. \u00d5ige andmet\u00fc\u00fcbi valik muudab playbookid paindlikumaks ja lihtsamaks.</p> T\u00fc\u00fcp N\u00e4ide Selgitus String <code>web_package: \"nginx\"</code> Tekstiv\u00e4\u00e4rtus. Soovitatav panna jutum\u00e4rkidesse, eriti kui sisaldab t\u00fchikuid v\u00f5i erim\u00e4rke. T\u00e4isarv (int) <code>max_clients: 200</code> Kasutatakse arvulistes seadistustes. T\u00f5ev\u00e4\u00e4rtus (bool) <code>debug_mode: true</code> Saab v\u00e4\u00e4rtusteks <code>true</code> v\u00f5i <code>false</code>. Loend (list) <code>packages: [nginx, curl, vim]</code> Mitme elemendi kogum, mida saab ts\u00fcklis l\u00e4bi k\u00e4ia. S\u00f5nastik (dict) <code>app: { name: demo, port: 8080 }</code> V\u00f5tme-v\u00e4\u00e4rtuse paaride kogum. Kasulik keerukamate seadistuste jaoks."},{"location":"ansible/ansiblevars/#naited-andmetuupide-kasutamisest","title":"N\u00e4ited andmet\u00fc\u00fcpide kasutamisest","text":"<pre><code>vars:\n  web_package: \"nginx\"           # string\n  max_clients: 200               # int\n  debug_mode: true               # bool\n  packages:                      # list\n    - nginx\n    - curl\n    - vim\n  app:                            # dict\n    name: demo\n    port: 8080\n\ntasks:\n  - name: Paigalda vajalikud paketid\n    apt:\n      name: \"{{ item }}\"\n      state: present\n    loop: \"{{ packages }}\"\n\n  - name: Kuva rakenduse nime ja pordi info\n    debug:\n      msg: \"Rakendus {{ app.name }} t\u00f6\u00f6tab pordis {{ app.port }}\"\n</code></pre>"},{"location":"ansible/ansiblevars/#faktide-facts-kasutamine","title":"Faktide (facts) kasutamine","text":"<p>Lisaks enda loodud muutujatele kogub Ansible automaatselt iga hosti kohta s\u00fcsteemiteavet, mida nimetatakse facts. Need sisaldavad n\u00e4iteks:</p> <ul> <li>operatsioonis\u00fcsteemi nime ja versiooni,</li> <li>tuuma (kernel) infot,</li> <li>IP-aadresse ja v\u00f5rguliideseid,</li> <li>m\u00e4lu ja protsessorite infot,</li> <li>ajav\u00f6\u00f6ndi jpm.</li> </ul> <p>See info on k\u00e4ttesaadav playbookides spetsiaalse muutuja <code>ansible_facts</code> kaudu.</p> <p>N\u00e4ide:</p> <pre><code>- name: Kuva hosti operatsioonis\u00fcsteem\n  hosts: all\n  tasks:\n    - name: Kuva OS info\n      debug:\n        msg: \"Hosti OS on {{ ansible_facts['distribution'] }}\"\n</code></pre> <p>Faktide kogumine toimub automaatselt enne playbooki \u00fclesannete t\u00e4itmist (v\u00e4lja arvatud juhul, kui <code>gather_facts: false</code> on m\u00e4\u00e4ratud). Saad vaadata k\u00f5iki k\u00e4ttesaadavaid fakte k\u00e4suga:</p> <pre><code>ansible all -m setup\n</code></pre> <p><code>setup</code> kuvab k\u00f5ik saadaval olevad faktid JSON-formaadis.</p> <p>Kui soovid kiirendada testimist v\u00f5i kui facts pole vajalikud, lisa playbooki alguses <code>gather_facts: false</code>.</p>"},{"location":"ansible/ansiblevars/#head-tavad-muutujate-kasutamisel","title":"Head tavad muutujate kasutamisel","text":"<ul> <li>Hoia korduvaid muutujad eraldi failides (group_vars, host_vars) selguse huvides.</li> <li>Kasuta selgeid ja \u00fchtseid muutujate nimesid.</li> <li>Pane vaikimisi v\u00e4\u00e4rtused madala prioriteediga kohta (nt group_vars/)</li> <li>\u00c4ra pane salas\u00f5nu v\u00f5i tundlikke andmeid otse playbooki \u2013 kasuta Ansible Vault\u2019i.</li> </ul>"},{"location":"ansible/ansiblevars/#harjutus","title":"Harjutus","text":"<ol> <li> <p>Loo <code>group_vars/webservers.yml</code> fail ja m\u00e4\u00e4ra seal:</p> <pre><code>web_package: nginx\nweb_root: /var/www/web\n</code></pre> </li> <li> <p>Loo host_vars/web1.yml fail, kus m\u00e4\u00e4rad teise v\u00e4\u00e4rtuse web_root muutujale.</p> <pre><code>web_root: /srv/web1_site\n</code></pre> </li> <li> <p>Loo lihtne playbook, mis:</p> <p>paigaldab {{ web_package }} loob kataloogi {{ web_root }}</p> </li> <li> <p>K\u00e4ivita playbook ja testi, kas eri hostidel kasutati erinevaid v\u00e4\u00e4rtusi.</p> </li> <li>Katseta muutujat k\u00e4surealt, nt:     <pre><code>ansible-playbook site.yml -e \"web_root=/tmp/test_site\"\n</code></pre>     Peakid m\u00e4rkama, et k\u00e4surealt m\u00e4\u00e4ratud v\u00e4\u00e4rtus kirjutab \u00fcle nii grupi- kui ka hostimuutujad.</li> </ol>"},{"location":"ansible/ansiblevars/#rohkem-infot","title":"Rohkem infot","text":"<ul> <li>Using Variables in Ansible</li> </ul>"},{"location":"ansible/ansiblevault/","title":"Turvalisus ja Ansible Vault","text":""},{"location":"ansible/ansiblevault/#eesmark","title":"Eesm\u00e4rk","text":"<p>Selles peat\u00fckis \u00f5pid:</p> <ul> <li>Mis on Ansible Vault ja milleks seda kasutatakse  </li> <li>Kuidas kr\u00fcpteerida tundlikke faile ja muutujaid  </li> <li>Kuidas vaadata, redigeerida ja dekr\u00fcpteerida Vault-faile  </li> <li>Kuidas kasutada Vault-parooli automaatselt  </li> <li>Kuidas integreerida Vault playbookidesse</li> </ul>"},{"location":"ansible/ansiblevault/#mis-on-ansible-vault","title":"Mis on Ansible Vault?","text":"<p>Ansible Vault v\u00f5imaldab kaitsta tundlikku teavet \u2013 n\u00e4iteks paroole, API v\u00f5tmeid, sertifikaate ja muid konfidentsiaalseid andmeid \u2013 kr\u00fcpteerides need.  </p> <p>Vaulti kasutamine on oluline, sest:</p> <ul> <li>Playbookid ja muutujad jagatakse tihti meeskonnas v\u00f5i versioonihalduses (nt GitHub).  </li> <li>Ilma kr\u00fcpteerimiseta v\u00f5ivad paroolid ja v\u00f5tmed sattuda avalikult k\u00e4ttesaadavaks.  </li> </ul> <p>Vault kasutab symmeetrilist AES-kr\u00fcpteerimist ja on t\u00e4ielikult integreeritud Ansible t\u00f6\u00f6voogu.</p>"},{"location":"ansible/ansiblevault/#vaulti-loomine","title":"Vaulti loomine","text":"<p>Vaultiga kaitstud faili saab luua k\u00e4suga:</p> <pre><code>ansible-vault create secrets.yml\n</code></pre> <p>See avab vaikimisi redaktori, kuhu saad sisestada oma tundlikud andmed:</p> <pre><code>db_user: admin\ndb_password: salajaneParool123\napi_token: 4bfa02d7...\n</code></pre> <p>Fail salvestatakse kr\u00fcpteerituna:</p> <pre><code>$ANSIBLE_VAULT;1.1;AES256\n643939313566366534653433396338663266633764336135393265...\n</code></pre> <p>Kui soovid kr\u00fcpteerida olemasoleva faili, kasuta: <pre><code>ansible-vault encrypt secrets.yml\n</code></pre></p>"},{"location":"ansible/ansiblevault/#vault-faili-avamine-ja-muutmine","title":"Vault-faili avamine ja muutmine","text":"<p>Kr\u00fcpteeritud faili saab avada v\u00f5i redigeerida ainult Vault-parooliga.</p> <ul> <li>Avamine (ilma muutmata):</li> </ul> <pre><code>  ansible-vault view secrets.yml\n</code></pre> <ul> <li>Muutmine:</li> </ul> <pre><code>  ansible-vault edit secrets.yml\n</code></pre> <ul> <li>Dekr\u00fcpteerimine (tavalisse teksti): <pre><code>ansible-vault decrypt secrets.yml\n</code></pre></li> </ul> <p>Warning</p> <p>Dekr\u00fcpteerimine eemaldab kaitse \u2013 kasuta seda ainult vajadusel!</p>"},{"location":"ansible/ansiblevault/#vault-faili-kasutamine-playbookis","title":"Vault-faili kasutamine playbookis","text":"<p>Vault-faile kasutatakse tavaliselt muutujaid sisaldavate failidena, mida Ansible loeb <code>vars_files:</code> kaudu.</p> <p>N\u00e4ide:</p> <pre><code>---\n- name: Kasuta Vaultis hoitavaid muutujaid\n  hosts: dbservers\n  become: yes\n  vars_files:\n    - secrets.yml\n\n  tasks:\n    - name: N\u00e4ita andmebaasi kasutajat (testiks)\n      debug:\n        msg: \"DB kasutaja on {{ db_user }}\"\n</code></pre> <p>Playbooki k\u00e4ivitamisel tuleb Vaulti sisu kasutamiseks sisestada Vault-parool, vastasel juhul Ansible ei saa kr\u00fcpteeritud andmeid avada.</p> <pre><code>ansible-playbook db.yml --ask-vault-pass\n</code></pre>"},{"location":"ansible/ansiblevault/#vault-parooli-automaatne-kasutamine","title":"Vault-parooli automaatne kasutamine","text":"<p>Et v\u00e4ltida parooli k\u00e4sitsi sisestamist iga kord, v\u00f5ib kasutada eraldi Vault paroolifaili.</p> <p>Vault-paroolifaili v\u00f5ib kasutada ainult isiklikus v\u00f5i turvalises keskkonnas. Hoia see fail v\u00e4ljaspool versioonihaldust (.gitignore), sea sellele \u00f5igused nt <code>chmod 600 vault_pass.txt</code> ja \u00e4ra jaga seda teiste kasutajatega.</p> <p>N\u00e4iteks loo fail <code>vault_pass.txt</code>:</p> <pre><code>MinuParool123\n</code></pre> <p>Seej\u00e4rel lisa k\u00e4sureale:</p> <pre><code>ansible-playbook db.yml --vault-password-file vault_pass.txt\n</code></pre> <p>Warning</p> <p>\u00c4ra salvesta parooliga faili versioonihaldusesse!</p>"},{"location":"ansible/ansiblevault/#vault-muutujate-loomine-otse-kasurealt","title":"Vault-muutujate loomine otse k\u00e4surealt","text":"<p>Vaulti saab kasutada ka \u00fcksiku muutuja kr\u00fcpteerimiseks otse k\u00e4surealt:</p> <pre><code>ansible-vault encrypt_string 'SalajaneParool123' --name 'db_password'\n</code></pre> <p>V\u00e4ljund:</p> <pre><code>db_password: !vault |\n          $ANSIBLE_VAULT;1.1;AES256\n          323935393462633634633464643438326565333162353534373731383932...\n</code></pre> <p>Seda saab otse lisada playbooki v\u00f5i <code>group_vars</code> failidesse.</p>"},{"location":"ansible/ansiblevault/#mitme-vaulti-kasutamine","title":"Mitme Vaulti kasutamine","text":"<p>Suuremates projektides v\u00f5ib kasutada mitut Vaulti (nt eraldi dev, test, prod keskkondade jaoks). Sellisel juhul saab kasutada Vault ID-sid:</p> <pre><code>ansible-vault encrypt --vault-id dev@prompt secrets-dev.yml\nansible-vault encrypt --vault-id prod@prompt secrets-prod.yml\n</code></pre> <p>K\u00e4ivitamisel:</p> <pre><code>ansible-playbook site.yml --vault-id dev@prompt --vault-id prod@prompt\n</code></pre> <p>See v\u00f5imaldab hallata eri parooliga kr\u00fcpteeritud failide komplekte.</p>"},{"location":"ansible/ansiblevault/#rohkem-infot","title":"Rohkem infot","text":"<ul> <li>Ansible Vault dokumentatsioon </li> <li>Kr\u00fcpteeritud stringide kasutamine </li> <li>Vault ID s\u00fcsteem </li> </ul>"},{"location":"linux/debpaigaldus/","title":"Debian Linuxi paigaldamine","text":"<p>Juhendis kasutatav tarkvara: Debian 12.10</p>"},{"location":"linux/debpaigaldus/#riistvara-nouded","title":"Riistvara n\u00f5uded","text":"<p>Debian Linuxi puhul saab paigaldada \u00fchest iso failist operatsioonis\u00fcsteemi nii graafilise t\u00f6\u00f6lauaga (GUI) kui ilma (CLI). J\u00e4rgnevalt on toodud soovitatavad parameetrid virutaalmasinal (VM) \u00fclesannete sooritamiseks.</p> <p>Graafilise keskkonnaga VM-i jaoks on vajalikud k\u00f5rgemad ressursid, kuna kasutajaliides ja GUI-rakendused n\u00f5uavad rohkem m\u00e4lu ja protsessorij\u00f5udlust.</p> <p>Ilma graafilise t\u00f6\u00f6lauata VM-i jaoks on vaja v\u00e4hem m\u00e4lu ja t\u00f6\u00f6tlemisv\u00f5imsust, sest t\u00f6\u00f6 toimib ainult CLI-re\u017eiimis.</p> <p>Soovitavad parameetrid:</p> GUICLI <p>Soovitavad parameetrid GUI puhul:</p> <ul> <li>Protsessor (CPU): V\u00e4hemalt 2 virtuaalset protsessorit</li> <li>M\u00e4lu (RAM): V\u00e4hemalt 4 GB</li> <li>K\u00f5vaketas: V\u00e4hemalt 16 GB</li> <li>Graafikam\u00e4lu V\u00e4hemalt 16MB suuremate monitoride jaoks</li> <li>Soovitav kasutada Xfce t\u00f6\u00f6lauda, sest see on v\u00e4hem ressursin\u00f5udlikum ja t\u00f6\u00f6tab seet\u00f5ttu VM-il sujuvamalt.</li> </ul> <p>Soovitavad parameetrid CLI puhul:</p> <ul> <li>Protsessor (CPU): V\u00e4hemalt 1 virtuaalne protsessor</li> <li>M\u00e4lu (RAM): V\u00e4hemalt 2 GB</li> <li>K\u00f5vaketas: V\u00e4hemalt 16 GB</li> </ul>"},{"location":"linux/debpaigaldus/#paigaldusprotsess","title":"Paigaldusprotsess","text":"<p>K\u00e4ivitades VM-i saab k\u00f5igepealt valida paigaldusviisi vahel ehk millist paigaldajat (installerit) kasutatakse. </p> <ul> <li>Graphical Install: Installer koos hiire toega</li> <li>Install: Installer ilma hiire toeta</li> </ul> <p>Info</p> <p>Pane t\u00e4hele, et antud valik m\u00f5jutab ainult paigaldusprotsessi, mitte tulemust. Ehk \"graphical install\" ei t\u00e4henda, et paigalduks Debian koos GUI-ga. GUI v\u00f5i CLI Debiani saame tehes valikuid hiljem paigaldusprotsessi tarkvara osas.</p> <p>Antud juhend on loodud \"Graphical install\" n\u00e4itel, kasutades legacy virtuaalmasinat (MBR). Vali paigaldusprotsessi alustamiseks \"Graphical install\".</p> <p></p> <p>K\u00f5igepealt tuleb teha keele ja asukoha ning klaviatuuri valik. J\u00e4rgnevalt on antud soovituslikud valikud, mida v\u00f5id vastavalt oma soovile kohandada:</p> <ul> <li>Select a language: English</li> <li>Select your location: other -&gt; Europe -&gt; Estonia</li> <li>Configure locales: en_US-UTF-8</li> <li>Configure the keyboard: Estonian</li> </ul> LanguageLocationLocalesKeyboard <p></p> <p></p> <p></p> <p></p> <p>Edasi toimub v\u00f5rgu seadistamine:</p> <ul> <li>Kui VM-il on v\u00f5rgukaart, mis on \u00fchendatud v\u00f5rguga, mis jagab DHCP kaudu parameetreid automaatselt, siis saadakse ka v\u00f5rguparameetrid automaatselt ja paigaldusprotsess j\u00e4tkub.</li> <li>Kui v\u00f5rguparameetreid automaatselt ei tuvastata, siis tuleb teade, et \"Network autoconfiguration failed\" ja tuleb lisada k\u00e4sitsi oma v\u00f5rgule sobivad parameetrid (IP address, subnet mask, gateway, DNS servers).</li> </ul> <p>Info</p> <p>Mitme DNS serveri puhul eralda need t\u00fchikuga, \u00e4ra kasuta koma.</p> Autoconfiguration failedManuallyIP/subnetGatewayDNS <p></p> <p></p> <p></p> <p></p> <p></p> <p>J\u00e4rgnevalt on vaja m\u00e4\u00e4rata arvutile v\u00f5rgunimi (hostname) ja domeen. Kui domeeni ei kasutata, siis v\u00f5ib v\u00e4lja t\u00e4itmata j\u00e4tta ja edasi liikuda.</p> HostnameDomain <p></p> <p></p> <p>Edasi toimub kasutajate ja paroolide seadistamine</p> <ul> <li>K\u00fcsitakse root kasutaja ehk juurkasutaja parooli. Parooli v\u00f5ib seadistada v\u00f5i j\u00e4tta m\u00e4\u00e4ramata.</li> </ul> <p>Info</p> <p>Soovitus on j\u00e4tta 'root' kasutaja parool m\u00e4\u00e4ramata. Selle tulemuena paigaldatakse 'sudo' ja kasutatakse seda kui soovime k\u00e4ske k\u00e4ivitada juurkasutaja \u00f5igustes. Parooli m\u00e4\u00e4ramisel sudo ei paigaldata ja juurkasutaja alla saab siseneda n\u00e4iteks 'su -' k\u00e4suga.</p> <ul> <li>Seej\u00e4rel tuleb sisestada kasutaja andmed (nimi, kasutajanimi ja luua parool).</li> </ul> Root passwordName for the userUsernamePassword <p></p> <p></p> <p></p> <p></p> <p>Paigaldus j\u00e4tkub kettajaotuse ehk partitsioonide seadistamisega. Kasutame automaatset ketaste jaotust, mis on soovitav algajatele ja paigaldame k\u00f5ik failid \u00fchele partitsioonile.</p> <ul> <li>Partitioning method: Guided - use entire Disk</li> <li>Select disk to partition: \u00fche ketta puhul on see juba valitud</li> <li>Partitioning scheme: All files in one partiton</li> <li>Write changes to disk: Yes</li> </ul> Partitioning methodSelect disk to partitionPartitioning schemeWrite changes to disk <p></p> <p></p> <p></p> <p></p> <p>J\u00e4rgmisena j\u00f5uame tarkvara allalaadisega seotud valikute juurde. </p> <ul> <li>K\u00fcsitakse, kas meil on veel m\u00f5ni paigaldusmeedium peale praeguse, vastame eitavalt.</li> <li>Seej\u00e4rel soovib Debian p\u00f6\u00f6rduda tarkvara allalaadimiseks tarkvara varamu poole. Vali riigiks Eesti ja nimekirjast \u00fcksk\u00f5ik milline ametilikest Debiani tarkvara varamutest.</li> <li>Kui v\u00e4lisv\u00f5rku p\u00e4\u00e4semiseks kasutatakse puhverserverit, siis on j\u00e4rgmises aknas v\u00f5imalik see m\u00e4\u00e4rata, kuid tavaliselt j\u00e4etakse see t\u00fchjaks. </li> <li>Seej\u00e4rel k\u00fcsitakse veel pakettide populaarsusuuringuses osalemise kohta (statistika saatmine), selle saab valida vastavalt isiklikule eelistusele.</li> </ul> Exrta installation mediaArchive mirror countryArchive mirrorProxyPopularity-contest <p></p> <p></p> <p></p> <p></p> <p></p> <p>Tarkvara valiku aknas saame linnukestega valida millise tarkvara me oma Debianile peale paigaldame. </p> <p>Info</p> <p>Vastavalt siin tehtud valikule saamegi GUI v\u00f5i CLI Debiani.</p> <p>Graafilise kasutajaliidesega Debiani puhul tuleb valida meelep\u00e4rane kasutajaliides. Ilma graafilise liidesega Debiani puhul tuleb eemaldada linnukesed kasutajaliideste eest.</p> <ul> <li>GUI: valime Xfce t\u00f6\u00f6laua, SSH serveri ja standard system utilities</li> <li>CLI: SSH serveri ja standard system utilities</li> </ul> GUICLI <p></p> <p></p> <p>Viimaseks valikuks on paigaldusprotsessis alglaaduri paigaldamine. Kui tegemist on ainukese operatsioonis\u00fcsteemiga arvutis tuleb GRUB alglaadur kindlasti paigaldada ja valida peamine ketas kuhu alglaadur lisatakse (N: sda).</p> <p>Warning</p> <p>Kui sa alglaadurit ei paigalda, siis ei laeta ka Debian operatsioonis\u00fcsteemi ehk peale paigaldusprotsessi Debian linux ei k\u00e4ivitu.</p> Install GRUBDevice for boot loader <p></p> <p></p> <p>Seej\u00e4rel on paigaldusprotsess l\u00f5ppenud ja vajalik on taask\u00e4ivitus, mille j\u00e4rgselt k\u00e4ivitub GUI versiooni puhul valitud kasutajaliides ja CLI versiooni puhul mittegraafiline Debian Linux.</p> <p>Info</p> <p>CLI Debiani puhul v\u00f5ib esmase Linuxi kasutaja jaoks tunduda, et parooli sisestamisel ei teki t\u00e4rne, see on  Linuxis tavap\u00e4rane n\u00e4htus. Tuleb sisestada parool tavap\u00e4rasel viisil ja vajutada \"Enterit\".</p> FinishGUIGUI loginCLICLI login <p></p> <p></p> <p></p> <p></p> <p></p>"}]}